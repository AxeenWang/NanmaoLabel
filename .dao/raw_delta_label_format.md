# 出貨標籤 QW075551-1 — CodeSoft 欄位對照修正規格

| 項目       | 內容                                        |
|------------|---------------------------------------------|
| 文件類型   | Delta Spec（標籤修正規格）                   |
| 對應標籤   | QW075551-1（出貨標籤 / Shipping Label）      |
| 基準文件   | raw_spec.md v2.5（§5.1 QW075551-1 欄位對應）|
| 建立日期   | 2026-02-02                                  |
| 狀態       | **定案**                                    |

---

## 1. 修正範圍說明

本文件針對 QW075551-1 出貨標籤的 **CodeSoft 欄位對照設定** 與 **QR Code 組合規格** 進行重新定義，取代 raw_spec.md §5.1「欄位對應」表格中的對應邏輯。

本次修正 **另涉及** 以下項目：

- 標籤實體尺寸：由 100mm × 60mm **變更為 100mm × 80mm**（見 §7）
- 版面座標定義：**以圖片版面為準**，取代 raw_spec.md §5.1 座標表（見 §4）
- 日期顯示格式：由 `yyyy-MM-dd` **變更為 `yyyy/MM/dd`**（見 §6）

本次修正 **不涉及** 以下項目（維持原規格不變）：

- 字型規格（raw_spec.md §5.3）
- 條碼規格（raw_spec.md §6）
- 資料處理規範（數量千分位顯示、Trim 空白等）
- PDF 輸出與驗收規範（第 13 章）

### 1.1 長文字溢出處理策略

| 項目 | 規則 |
|------|------|
| 處理方式 | **不可截斷**，採用**縮小字體**方式處理 |
| 適用範圍 | 所有 Text 欄位 |
| 實作位置 | LabelRenderer |

### 1.2 QW075551-2 影響聲明

本 Delta Spec **僅針對 QW075551-1**，QW075551-2 將於後續另行修正。

> ⚠️ 注意：標籤尺寸變更為 100mm × 80mm 後，預覽介面的縮放比例計算會影響 QW075551-2 的顯示，此為預期行為。

---

## 2. CodeSoft 欄位對照定義（唯一正確來源）

以下表格為 QW075551-1 所有 CodeSoft 變數欄位的完整定義，**取代** raw_spec.md §5.1 Item 1–8 的欄位對應。

> 📌 程式碼實作時使用「資料來源欄位」名稱（如 `nvr_cust`），CodeSoft 欄位名僅供規格對照使用。

| Item | CodeSoft 欄位    | 資料來源欄位      | 資料來源說明 | 顯示類型 |
|------|------------------|-------------------|-------------|----------|
| 1    | CSCUSTOMER       | nvr_cust          | 客戶名稱    | Text     |
| 2    | FINDPRTDC        | obe25             | 日期        | Text     |
| 3    | CSQTY            | ogd09             | 數量        | Text     |
| 4    | CSCUSTITEMNO     | nvr_cust_item_no  | 客戶料號    | Text     |
| 5    | CSCUSTPN         | nvr_cust_pn       | 客戶 P/N   | Text     |
| 6    | CSMO             | pono              | 製令單號    | Text     |
| 7    | OUTDEVICENO      | ima902            | 裝置編號    | Text     |
| 8    | CSREMARK         | nvr_remark10      | 備註        | Text     |

### 2.1 與原規格差異說明

| 項目                        | 原規格（raw_spec.md §5.1）        | 本次修正                          | 變更性質         |
|-----------------------------|-----------------------------------|-----------------------------------|------------------|
| Item 1–4, 6–8 資料來源      | 同左                              | 無變更（重新確認）                | 確認，無異動     |
| Item 5 CSCUSTPN 顯示類型    | **Barcode**（Code 128）           | **Text**                          | **變更**         |
| QR Code 組合方式            | 使用資料源欄位名語法 `{pono};...` | 使用 CodeSoft 欄位名定義（見§3）  | **變更**（見§3） |

> ⚠️ **Code 128 移除聲明**：本標籤移除所有 Code 128 條碼，僅保留 QR Code 作為唯一條碼類型。

### 2.2 Item 5 變更詳述

| 項目     | 說明                                                                                     |
|----------|------------------------------------------------------------------------------------------|
| 欄位     | CSCUSTPN                                                                                 |
| 原定義   | Type = Barcode（Code 128），版面座標 X=5, Y=35, 寬=60mm, 高=10mm                        |
| 修正後   | Type = **Text**，依圖片版面呈現為 CSCUSTITEMNO 下方的純文字行                            |
| 修正依據 | 出貨標籤格式圖與預覽圖均顯示 CSCUSTPN 為純文字（範例值 `E110-X0`），無條碼渲染          |
| 影響     | 原 Barcode 座標（Y=35, 高度=10mm）不再適用，需依版面重新配置為 Text 座標                |

> 📌 CSCUSTPN 變更為 Text 後，版面定位規則：**置於 CSCUSTITEMNO 正下方，X 座標相同，Y 座標 +ΔY**（ΔY 由版面實作決定）。

---

## 3. QR Code 規格定義

### 3.1 QR Code 欄位組合（取代原規格 §5.1 Item 9）

| 項目         | 定義                                                |
|--------------|-----------------------------------------------------|
| CodeSoft 欄位| QRCODE                                              |
| 顯示類型     | QRCode                                              |
| 分隔符號     | 分號 `;`                                            |
| 欄位數量     | 4 個（不可增減）                                    |
| 組合順序     | CSMO;OUTDEVICENO;CSQTY;CSREMARK                    |

### 3.2 QR Code 各欄位對應資料來源

| 順序 | CodeSoft 欄位 | 資料來源欄位   | 說明     |
|------|---------------|---------------|----------|
| 1    | CSMO          | pono          | 製令單號 |
| 2    | OUTDEVICENO   | ima902        | 裝置編號 |
| 3    | CSQTY         | ogd09         | 數量     |
| 4    | CSREMARK      | nvr_remark10  | 備註     |

### 3.3 QR Code 編碼內容範例

以附錄 A 範例資料為基準：

```
511-251020041;FC7800280H-00000-00005;6733;00U35NVVR
```

### 3.4 與原規格差異說明

| 項目                 | 原規格（raw_spec.md §5.1 Item 9）            | 本次修正                                     |
|----------------------|----------------------------------------------|----------------------------------------------|
| 組合語法             | `{pono};{ima902};{ogd09};{nvr_remark10}`     | `CSMO;OUTDEVICENO;CSQTY;CSREMARK`           |
| 語意差異             | 使用**資料源欄位名**作為變數引用             | 使用 **CodeSoft 欄位名**作為變數引用         |
| 實際編碼內容         | 511-251020041;FC7800280H-00000-00005;6733;00U35NVVR | **相同**（底層資料來源一致）           |
| 欄位順序與數量       | 4 個欄位，順序同左                           | **相同**                                     |

> 📌 本次修正將 QR Code 的組合定義從「資料源欄位名語法」統一改為「CodeSoft 欄位名語法」，使 CodeSoft 標籤設計端與規格文件的欄位命名一致，避免跨系統對照時的歧義。實際編碼輸出內容不受影響。

### 3.5 QR Code 通用規格（維持不變）

以下規格沿用 raw_spec.md §6.2，本次不修正：

| 項目       | 規格                       |
|------------|----------------------------|
| 尺寸       | **20mm × 20mm**（維持不變） |
| 容錯等級   | Level M（15%）             |
| 編碼格式   | UTF-8                      |
| Quiet Zone | 四周各 4 倍單元寬度，不可裁切 |
| 下方文字   | 不顯示                     |
| 空值處理   | 欄位為空時輸出空字串，保留分號位置 |

---

## 4. 版面配置參考說明

本次修正以「出貨標籤格式.png」與「出貨標籤預覽.png」作為版面參考，以下為圖片所示版面與原規格（raw_spec.md §5.1 座標表）的差異觀察：

### 4.1 版面差異觀察

| 區域             | 原規格版面（raw_spec.md §5.1）                     | 圖片版面                                          | 差異類型       |
|------------------|---------------------------------------------------|---------------------------------------------------|----------------|
| Remarks 區段     | 三列獨立標籤：MO: / Device: / Remark:，各帶前綴   | 單一「Remarks」標籤，下方依序列出 CSMO、OUTDEVICENO、CSREMARK | **版面結構變更** |
| QR Code 位置     | 右下角（X=75, Y=40）                              | 左下角（Remarks 標籤下方）                         | **位置變更**    |
| CSCUSTPN 呈現    | Barcode（Code 128），獨立條碼區域                  | 純文字，位於 CSCUSTITEMNO 下方                     | **類型變更**（已於 §2.2 定義） |

### 4.2 本次修正範圍界定

| 差異項目                         | 是否納入本次修正 | 說明                                                         |
|----------------------------------|------------------|--------------------------------------------------------------|
| CSCUSTPN 類型由 Barcode → Text   | ✅ 已納入        | 見 §2.2                                                     |
| QR Code 組合語法統一             | ✅ 已納入        | 見 §3                                                       |
| Remarks 區段版面結構調整         | ✅ 已納入        | 見 §4.3                                                     |
| QR Code 位置由右下角移至左下角   | ✅ 已納入        | 見 §4.3                                                     |
| 版面座標全面重新定義             | ✅ 已納入        | **本次實作以圖片版面為準**，取代原規格座標表                 |

> 📌 本次實作以「出貨標籤格式.png」與「出貨標籤預覽.png」為唯一版面權威來源，原 raw_spec.md §5.1 座標表不再適用。

### 4.3 座標配置授權

| 項目 | 說明 |
|------|------|
| 授權方式 | 開發者依圖片自行配置各欄位 X/Y/Width/Height |
| 驗收標準 | **以 PDF 輸出為唯一驗收依據**，版面視覺呈現符合圖片即可 |
| 調整彈性 | 允許微調間距、對齊，不需完全吻合圖片像素 |

### 4.4 版面配置規則（以圖片為準）

| 區域 | 版面規則 | 說明 |
|------|----------|------|
| Product NO. 區段 | CSCUSTITEMNO 在上，CSCUSTPN 在下 | 兩者 X 座標相同，垂直排列 |
| Remarks 區段 | 「Remarks」標籤 + QR Code + 三行文字 | 見 §4.5 詳細配置 |
| 欄位前綴標籤 | "Product NO." 為正確拼寫 | 原圖 "Peoduct NO." 為 typo，實作時應修正 |

### 4.5 Remarks 區段版面配置

Remarks 區段採用 **QR Code 與文字並排** 的配置：

```
┌─────────────────────────────────────────────────────────────┐
│   Remarks      CSMO                                         │
│   ┌─────────┐  OUTDEVICENO                                  │
│   │ QR Code │  CSREMARK                                     │
│   │ 20x20mm │                                               │
│   └─────────┘                                               │
└─────────────────────────────────────────────────────────────┘
```

#### 座標配置表（參考值）

| 元素 | X (mm) | Y (mm) | Width (mm) | Height (mm) | 說明 |
|------|--------|--------|------------|-------------|------|
| "Remarks" 標籤 | 5 | 50 | 20 | 4 | 固定文字，與 CSMO 同高 |
| QR Code | 5 | 55 | 20 | 20 | 在 "Remarks" 下方 |
| CSMO | 28 | 55 | 67 | 4 | QR Code 右側（間距 3mm） |
| OUTDEVICENO | 28 | 60 | 67 | 4 | 行距 5mm |
| CSREMARK | 28 | 65 | 67 | 4 | 行距 5mm |

#### 配置說明

| 項目 | 數值 | 說明 |
|------|------|------|
| QR Code 與文字間距 | 3mm | QR Code 右邊緣到文字起始 |
| 文字行距 | 5mm | CSMO / OUTDEVICENO / CSREMARK 三行間距 |
| Remarks 區段起始 Y | 50mm | 從標籤頂部算起 |
| 文字區域寬度 | 67mm | 28mm 到 95mm（右邊留 5mm margin） |

> 📌 以上座標為參考值，開發者可依實際渲染效果微調，以 PDF 輸出視覺呈現為驗收標準。

---

## 5. 固定元素與版面設計

以下為圖片中可觀察到的固定元素：

| 項目                                     | 處置                     | 說明                                         |
|------------------------------------------|--------------------------|----------------------------------------------|
| 標題列「出貨標籤 / Shipping Label」       | 沿用原規格               | 為固定文字，非 CodeSoft 變數欄位             |
| 欄位前綴標籤文字（Customer、Date 等）     | 沿用原規格               | 為固定文字                                   |

### 5.1 標籤邊框

| 項目 | 規格 |
|------|------|
| 外框 | **需要繪製**，單線矩形邊框 |
| 分隔線 | **不需要**（圖片所示分隔線僅供參考，實作時不繪製） |
| 線條粗細 | 由版面實作決定，建議 0.5pt ~ 1pt |
| 實作位置 | LabelRenderer |

### 5.2 欄位前綴標籤顯示規則

| 項目 | 規格 |
|------|------|
| 顯示方式 | **雙行顯示**（中英文分行） |
| 範例 | "Customer" 第一行、"客戶名稱" 第二行 |
| 適用欄位 | Customer/客戶名稱、Product NO./產品型號 |

### 5.3 圖片 Typo 修正

| 項目 | 圖片原文 | 正確拼寫 | 處置 |
|------|----------|----------|------|
| 欄位前綴標籤 | "Peoduct NO." | "Product NO." | 實作時應使用正確拼寫 |

---

## 6. 資料格式處理規則

以下規則部分沿用 raw_spec.md §3.3，部分本次修正：

| CodeSoft 欄位 | 適用規則                                              | 變更狀態 |
|---------------|-------------------------------------------------------|----------|
| FINDPRTDC     | 日期格式轉換：統一為 **`yyyy/MM/dd`**                 | **變更**（原為 `yyyy-MM-dd`） |
| CSQTY         | 顯示值加入千分位（如 `6,733`）；QR Code 編碼使用原始值（如 `6733`） | 沿用 |
| 其他 Text 欄位| Trim 前後空白，保持原值                                | 沿用 |

> 📌 日期顯示格式由原規格 `yyyy-MM-dd` **變更為 `yyyy/MM/dd`**（斜線分隔），以符合實際標籤預覽圖呈現。

### 6.1 日期格式轉換實作位置

| 項目 | 說明 |
|------|------|
| 實作位置 | **LabelRenderer**（渲染階段轉換） |
| 輸入格式 | `yyyy-MM-dd`（資料儲存格式） |
| 輸出格式 | `yyyy/MM/dd`（標籤顯示格式） |
| 轉換時機 | 渲染 FINDPRTDC 欄位時進行 |

### 6.2 空值處理（Text 欄位）

| 項目 | 規則 |
|------|------|
| 處理方式 | Text 欄位為空時顯示空字串 |
| 版面影響 | **保留版面位置**，不跳過、不收合 |
| 適用範圍 | 所有 Text 欄位（CSCUSTOMER、FINDPRTDC、CSQTY、CSCUSTITEMNO、CSCUSTPN、CSMO、OUTDEVICENO、CSREMARK） |

---

## 7. 標籤實體尺寸變更

| 項目     | 原規格（raw_spec.md §5.1）| 本次修正       |
|----------|--------------------------|----------------|
| 標籤寬度 | 100mm                    | 100mm（不變）  |
| 標籤高度 | 60mm                     | **80mm**       |

> 📌 標籤高度增加 20mm，配合本次版面以圖片為準的調整（見 §4），下半部區域（Remarks / QR Code）獲得更充裕的配置空間。

### 7.1 連帶影響

| 影響項目                     | 說明                                                     |
|------------------------------|----------------------------------------------------------|
| PDF 輸出頁面尺寸             | 原為 100mm × 60mm，需同步調整為 **100mm × 80mm**         |
| 預覽區縮放比例               | 預覽畫面的等比例縮放基準需配合新尺寸重新計算             |
| 批次輸出 PDF 規格（§3.3）    | 頁面尺寸描述需同步更新為 100mm × 80mm                    |

---

## 8. 驗收 Checklist

以下為本次 Delta Spec 的驗收項目，**以 PDF 輸出為唯一驗收依據**：

| # | 項目 | 驗證方式 | 預期結果 |
|---|------|----------|----------|
| 1 | 標籤尺寸 | PDF 頁面尺寸檢查 | 100mm × 80mm |
| 2 | 日期格式 | 目視檢查 FINDPRTDC | `yyyy/MM/dd`（如 2025/11/14） |
| 3 | CSCUSTPN 顯示 | 目視檢查 | 純文字（非條碼），位於 CSCUSTITEMNO 下方 |
| 4 | QR Code 位置 | 目視檢查 | 左下角，Remarks 文字下方 |
| 5 | QR Code 尺寸 | 量測 | 20mm × 20mm |
| 6 | QR Code 內容 | 掃描驗證 | `{CSMO};{OUTDEVICENO};{CSQTY};{CSREMARK}` 格式正確 |
| 7 | CSQTY 顯示值 | 目視檢查 | 有千分位（如 6,733） |
| 8 | QR Code 內 CSQTY | 掃描驗證 | 無千分位（如 6733） |
| 9 | 標籤邊框 | 目視檢查 | 有外框（無分隔線） |
| 10 | Product NO. 拼寫 | 目視檢查 | "Product NO."（非 "Peoduct NO."） |
| 11 | 長文字處理 | 以超長測試資料驗證 | 縮小字體，不截斷 |
| 12 | Code 128 移除 | 目視檢查 | 無任何 Code 128 條碼 |
| 13 | 雙語標籤 | 目視檢查 | Customer/客戶名稱、Product NO./產品型號 為中英文分行顯示 |

---

## 附錄 A：欄位對照速查表

以下為 QW075551-1 完整欄位對照的最終版本（含固定欄位與 QR Code）：

| Item | CodeSoft 欄位    | 資料來源         | Type    | 備註                |
|------|------------------|------------------|---------|---------------------|
| 1    | CSCUSTOMER       | nvr_cust         | Text    |                     |
| 2    | FINDPRTDC        | obe25            | Text    | 日期格式轉換        |
| 3    | CSQTY            | ogd09            | Text    | 顯示值含千分位      |
| 4    | CSCUSTITEMNO     | nvr_cust_item_no | Text    |                     |
| 5    | CSCUSTPN         | nvr_cust_pn      | Text    | ⚠️ 原為 Barcode，本次變更為 Text |
| 6    | CSMO             | pono             | Text    |                     |
| 7    | OUTDEVICENO      | ima902           | Text    |                     |
| 8    | CSREMARK         | nvr_remark10     | Text    |                     |
| 9    | QRCODE           | CSMO;OUTDEVICENO;CSQTY;CSREMARK | QRCode | 以分號串接，不可增減欄位 |
