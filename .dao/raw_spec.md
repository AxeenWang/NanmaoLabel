# 南茂標籤列印 POC 需求規格書

| 項目 | 內容 |
|------|------|
| 文件版本 | v2.5 |
| 建立日期 | 2025-01-26 |
| 修訂日期 | 2026-01-28 |
| 狀態 | **定稿** |

---

## 1. 專案概述

本 POC (Proof of Concept) 旨在驗證「新平台」的核心功能：**讀取交易資料，依據預定義的標籤格式，產出正確且條碼可被掃描的標籤檔案**。

POC 階段標籤格式（QW075551-1、QW075551-2）直接內建於程式碼中，專注驗證資料對應與條碼輸出的正確性。未來正式版本再擴展為可由外部設定檔驅動。

---

## 2. 系統架構

### 2.1 整體架構圖

```
┌─────────────────────────────────────────────────────────────────────┐
│                           系統架構                                  │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  ┌─────────────────────┐                  ┌───────────────────────┐ │
│  │ 程式碼內建          │─────────────────▶│ 標籤格式下拉選單     │ │
│  │ 兩種標籤格式定義    │                  │ (QW075551-1 / -2)    │ │
│  │ - QW075551-1        │                  └───────────────────────┘ │
│  │ - QW075551-2        │                                            │
│  └─────────────────────┘                                            │
│                                                                     │
│  ┌─────────────────────┐  ┌─────────────┐ ┌───────────────────────┐ │
│  │ Data.xlsx           │─▶│ data.json   │▶│ ListView 資料清單    │ │
│  │ (交易資料)          │  │ (本地儲存)  │ └───────────┬───────────┘ │
│  └─────────────────────┘  └─────────────┘             │ 選取        │
│                                                       ▼             │
│                                           ┌───────────────────────┐ │
│                                           │ 標籤預覽              │ │
│                                           └───────────┬───────────┘ │
│                                                       │ 輸出        │
│                                                       ▼             │
│                                           ┌───────────────────────┐ │
│                                           │ PDF 檔案              │ │
│                                           └───────────────────────┘ │
└─────────────────────────────────────────────────────────────────────┘
```

### 2.2 資料儲存架構

| 項目 | 儲存方式 | 說明 |
|------|----------|------|
| 標籤格式定義 | 程式碼內建 | QW075551-1、QW075551-2 兩種格式直接定義於程式中 |
| 交易資料 | JSON 檔案 | Excel 匯入後儲存為 data.json，作為本地快取 |

**設計優點：**

| 項目 | 說明 |
|------|------|
| 啟動快速 | 讀取 JSON 比讀取 Excel 快 |
| 離線可用 | 匯入後不需要原始 Excel 檔案 |
| POC 簡潔 | 標籤格式內建，減少解析複雜度 |
| 易於擴展 | 未來可將內建格式改為外部設定檔 |

**匯入策略：** POC 階段採用「覆蓋模式」，重新匯入時整份取代。

### 2.3 檔案路徑規範

| 項目 | 路徑 | 說明 |
|------|------|------|
| 程式執行檔 | `NanmaoLabelPOC.exe` | 主程式 |
| 資料目錄 | `.\data\` | 存放 JSON 資料檔 |
| 資料檔案 | `.\data\data.json` | 交易資料快取 |
| 輸出目錄 | `.\output\` | PDF 輸出預設目錄 |

**目錄結構：**

```
NanmaoLabelPOC/
├── NanmaoLabelPOC.exe
├── data/
│   └── data.json
├── output/
│   ├── Label_G25A111577_20250126_143052.pdf
│   └── Labels_Batch_20250126_150000.pdf
└── samples/
    └── MockData.xlsx
```

**PDF 輸出行為：**

| 項目 | 說明 |
|------|------|
| 預設目錄 | `.\output\`（不跳出對話框） |
| 檔名格式 | 單筆：`Label_{單據編號}_{日期時間}.pdf`，批次：`Labels_Batch_{日期時間}.pdf` |
| 目錄不存在 | 自動建立 |
| 輸出完成 | 狀態列顯示完整路徑，批次輸出完成後可選擇開啟資料夾 |

### 2.4 輸入 (Input)

| 項目 | 說明 |
|------|------|
| 資料源 (Data.xlsx) | 從 SAP/TIPTOP 匯出的交易資料 |

### 2.5 處理 (Process)

| 項目 | 說明 |
|------|------|
| Excel 解析器 | 讀取 Excel，轉換為 JSON 儲存 |
| JSON 載入器 | 程式啟動時載入 data.json |
| 解析引擎 | 依內建標籤格式，將資料源轉換為標籤內容 |
| 渲染引擎 | 依欄位類型 (Text/Barcode/QRCode) 繪製標籤 |

### 2.6 輸出 (Output)

| 項目 | 說明 |
|------|------|
| 螢幕預覽 | 即時顯示標籤樣式 |
| PDF 匯出 | 輸出可列印的 PDF 檔案 |

### 2.7 分頁資料同步機制

系統採用「**儲存後同步**」策略，確保資料一致性。

```
┌─────────────────┐                              ┌─────────────────┐
│  標籤列印分頁   │◀─────── 讀取 ───────────────│  data.json      │
│  (唯讀顯示)     │                              │                 │
└─────────────────┘                              └────────┬────────┘
                                                          │
┌─────────────────┐     ┌─────────────────┐               │
│  資料管理分頁   │────▶│  編輯用資料     │──── [儲存] ───┘
│  (編輯)         │◀────│  (記憶體)       │
└─────────────────┘     └─────────────────┘
```

**同步規則：**

| 操作 | 行為 |
|------|------|
| 程式啟動 | 讀取 data.json 載入兩個分頁 |
| 資料管理編輯 | 僅更新記憶體中的編輯用資料 |
| 點擊 [儲存] | 寫入 data.json，同時更新標籤列印分頁的顯示 |
| 切換分頁（未儲存） | 提示「資料尚未儲存」對話框 |
| 匯入 Excel | 覆蓋 data.json，同時更新兩個分頁 |

---

## 3. 功能需求

### 3.1 標籤列印功能

| 編號 | 功能 | 說明 |
|------|------|------|
| F-01 | 資料源匯入 | 讀取 Data.xlsx，解析後儲存為 data.json |
| F-02 | JSON 自動載入 | 程式啟動時自動載入 data.json |
| F-03 | 變數對應解析 | 將標籤欄位對應至資料源取值 |
| F-04 | 常數值處理 | 識別固定值，直接輸出（如 "17008"） |
| F-05 | 標籤格式切換 | 支援 QW075551-1 及 QW075551-2 兩種內建格式 |
| F-06 | 標籤預覽 | 畫面即時顯示標籤樣式，含文字與條碼 |
| F-07 | 條碼生成 | 支援 Code 128（一維）及 QR Code（二維） |
| F-08 | PDF 輸出 | 將標籤輸出成 PDF，條碼可被掃描 |
| F-09 | 批次處理 | 支援多筆資料整批產生標籤 |

> **備註：**「讀取 Excel 時需強制將所有內容視為字串 (String) 處理，避免前導零消失。」

### 3.2 資料管理功能

| 編號 | 功能 | 說明 |
|------|------|------|
| F-10 | 新增資料 | 手動新增一筆交易資料 |
| F-11 | 編輯資料 | 修改現有資料欄位值 |
| F-12 | 刪除資料 | 刪除選取的資料列 |
| F-13 | 儲存資料 | 將變更儲存至 data.json |

### 3.3 資料處理規範

**Excel 匯入規則：**

| 項目 | 規則 |
|------|------|
| 欄位名稱 | 首列為欄位名稱 |
| 大小寫 | **不分大小寫**（ogb19、OGB19、Ogb19 皆可） |
| 空白列 | 自動忽略 |
| 空白欄位 | 允許，儲存為空字串 |
| 分號檢查 | 欄位值包含分號時顯示警告（影響 QR Code） |

**資料格式轉換：**

| 欄位類型 | 轉換規則 | 範例 |
|----------|----------|------|
| 日期 | 統一轉換為 `yyyy-MM-dd` | 2025/11/14 → 2025-11-14 |
| 數量 | 顯示時加入千分位 | 6733 → 6,733 |
| 一般文字 | **Trim 前後空白**，保持原值 | " ABC " → "ABC" |

> **重要：** 所有欄位值必須 Trim 前後空白，避免條碼/QR Code 掃描內容多出空白造成比對失敗。

**長文字溢出處理：**

| 規則 | 說明 |
|------|------|
| 策略 | **先裁切，不縮字**（統一策略，每個欄位不得自行發揮） |
| 裁切方式 | 超出寬度時截斷並加上 `...`（Ellipsis） |
| 換行 | 不自動換行（除非欄位明確允許） |
| 縮字 | 不自動縮小字體 |

**欄位缺失處理：**

| 情境 | 處理方式 |
|------|----------|
| 標籤必要欄位缺失 | 彈出警告視窗：「資料缺失：{欄位名稱}，無法產生標籤」 |
| 非必要欄位缺失 | 該欄位顯示空白，不影響輸出 |

**批次輸出 PDF 規格：**

| 項目 | 規格 |
|------|------|
| 排版方式 | 每頁一張標籤 |
| 頁面尺寸 | 100mm x 60mm（與標籤尺寸一致） |
| 輸出完成 | 顯示「批次輸出完成」對話框，可選擇開啟資料夾 |

---

## 4. 標籤格式定義規則

POC 階段標籤格式直接內建於程式碼中，以下說明欄位對應規則。

### 4.1 欄位類型

| 類型 | 說明 | 範例 |
|------|------|------|
| Text | 純文字顯示 | 客戶名稱、日期、數量 |
| Barcode | 一維條碼 (Code 128) | 客戶 P/N、ERP 料號 |
| QRCode | 二維條碼 | 組合欄位資訊 |

### 4.2 資料對應規則

| 規則類型 | 說明 | 範例 |
|----------|------|------|
| 變數對應 | 從資料源取得對應欄位值 | nvr_cust → 客戶名稱 |
| 常數值 | 直接輸出固定值 | "17008" |
| 組合欄位 | 多欄位以分號串接（用於 QR Code） | {pono};{ima902};{ogd09} |

---

## 5. 標籤格式定義

### 5.1 QW075551-1（出貨標籤）

**尺寸：100mm x 60mm**

```
┌─────────────────────────────────────────────────┐
│           出貨標籤 Shipping Label               │
├─────────────────────────────────────────────────┤
│ Customer 客戶名稱    [CSCUSTOMER]               │
├─────────────────────────────────────────────────┤
│ Date [FINDPRTDC]          Q'ty [CSQTY]          │
├─────────────────────────────────────────────────┤
│ Product NO. 產品型號                            │
│ [CSCUSTITEMNO]                                  │
│ [CSCUSTPN]                                      │
├─────────────────────────────────────────────────┤
│ MO: [CSMO]                      ┌─────────┐     │
│ Device: [OUTDEVICENO]           │ QR Code │     │
│ Remark: [CSREMARK]              └─────────┘     │
└─────────────────────────────────────────────────┘
```

**欄位對應：**

| Item | 標籤欄位 | 邏輯處理 | Type | 說明 |
|------|----------|----------|------|------|
| 1 | CSCUSTOMER | nvr_cust | Text | 客戶名稱 |
| 2 | FINDPRTDC | obe25 | Text | 日期 |
| 3 | CSQTY | ogd09 | Text | 數量 |
| 4 | CSCUSTITEMNO | nvr_cust_item_no | Text | 客戶料號 |
| 5 | CSCUSTPN | nvr_cust_pn | Barcode | 客戶 P/N |
| 6 | CSMO | pono | Text | 製令單號 |
| 7 | OUTDEVICENO | ima902 | Text | 裝置編號 |
| 8 | CSREMARK | nvr_remark10 | Text | 備註 |
| 9 | QRCODE | {pono};{ima902};{ogd09};{nvr_remark10} | QRCode | QR Code |

**版面座標（單位：mm，原點為左上角）：**

| 欄位 | X | Y | 寬度 | 高度 | 字型大小 | 對齊 |
|------|---|---|------|------|----------|------|
| 標題 "出貨標籤 Shipping Label" | 5 | 2 | 90 | 6 | 14pt Bold | 置中 |
| 標籤 "Customer 客戶名稱" | 5 | 10 | 30 | 4 | 9pt | 靠左 |
| CSCUSTOMER | 36 | 10 | 59 | 5 | 11pt Bold | 靠左 |
| 標籤 "Date" | 5 | 17 | 10 | 4 | 9pt | 靠左 |
| FINDPRTDC | 16 | 17 | 25 | 5 | 11pt | 靠左 |
| 標籤 "Q'ty" | 55 | 17 | 10 | 4 | 9pt | 靠左 |
| CSQTY | 66 | 17 | 29 | 5 | 11pt Bold | 靠左 |
| 標籤 "Product NO. 產品型號" | 5 | 24 | 40 | 4 | 9pt | 靠左 |
| CSCUSTITEMNO | 5 | 29 | 90 | 5 | 11pt | 靠左 |
| CSCUSTPN (Barcode) | 5 | 35 | 60 | 10 | - | 靠左 |
| 標籤 "MO:" | 5 | 47 | 10 | 4 | 9pt | 靠左 |
| CSMO | 16 | 47 | 40 | 4 | 10pt | 靠左 |
| 標籤 "Device:" | 5 | 51 | 15 | 4 | 9pt | 靠左 |
| OUTDEVICENO | 21 | 51 | 35 | 4 | 10pt | 靠左 |
| 標籤 "Remark:" | 5 | 55 | 15 | 4 | 9pt | 靠左 |
| CSREMARK | 21 | 55 | 35 | 4 | 10pt | 靠左 |
| QRCODE | 75 | 40 | 20 | 20 | - | - |

---

### 5.2 QW075551-2

**尺寸：100mm x 60mm**

```
┌─────────────────────────────────────────────────┐
│           出貨標籤 Shipping Label               │
├─────────────────────────────────────────────────┤
│ Customer PO: [CSCUSTPO]                         │
├─────────────────────────────────────────────────┤
│ CS Number: [CSNUMBER]     Q'ty [CSQTY]          │
├─────────────────────────────────────────────────┤
│ ERP Part NO.                                    │
│ [ERPPARTNO]                                     │
├─────────────────────────────────────────────────┤
│ Customer Item: [CSCUSTITEMNO]   ┌─────────┐     │
│ Remark: [CSREMARK]              │ QR Code │     │
│                                 └─────────┘     │
└─────────────────────────────────────────────────┘
```

**欄位對應：**

| Item | 標籤欄位 | 邏輯處理 | Type | 說明 |
|------|----------|----------|------|------|
| 1 | CSCUSTPO | cscustpo | Text | 客戶採購單號 |
| 2 | CSNUMBER | "17008" | Text | 固定值 |
| 3 | ERPPARTNO | erpmat | Barcode | ERP 料號 |
| 4 | CSCUSTITEMNO | nvr_cust_item_no | Text | 客戶料號 |
| 5 | CSQTY | ogd09 | Text | 數量 |
| 6 | CSREMARK | nvr_remark10 | Text | 備註 |
| 7 | QRCODE | {cscustpo};{erpmat};{ogd09} | QRCode | QR Code |

**版面座標（單位：mm，原點為左上角）：**

| 欄位 | X | Y | 寬度 | 高度 | 字型大小 | 對齊 |
|------|---|---|------|------|----------|------|
| 標題 "出貨標籤 Shipping Label" | 5 | 2 | 90 | 6 | 14pt Bold | 置中 |
| 標籤 "Customer PO:" | 5 | 10 | 30 | 4 | 9pt | 靠左 |
| CSCUSTPO | 36 | 10 | 59 | 5 | 11pt Bold | 靠左 |
| 標籤 "CS Number:" | 5 | 17 | 25 | 4 | 9pt | 靠左 |
| CSNUMBER | 31 | 17 | 15 | 5 | 11pt | 靠左 |
| 標籤 "Q'ty" | 55 | 17 | 10 | 4 | 9pt | 靠左 |
| CSQTY | 66 | 17 | 29 | 5 | 11pt Bold | 靠左 |
| 標籤 "ERP Part NO." | 5 | 24 | 30 | 4 | 9pt | 靠左 |
| ERPPARTNO (Barcode) | 5 | 29 | 60 | 10 | - | 靠左 |
| 標籤 "Customer Item:" | 5 | 42 | 30 | 4 | 9pt | 靠左 |
| CSCUSTITEMNO | 36 | 42 | 30 | 4 | 10pt | 靠左 |
| 標籤 "Remark:" | 5 | 48 | 15 | 4 | 9pt | 靠左 |
| CSREMARK | 21 | 48 | 45 | 4 | 10pt | 靠左 |
| QRCODE | 75 | 40 | 20 | 20 | - | - |

### 5.3 字型規格總覽

| 用途 | 字型 | 大小 | 樣式 |
|------|------|------|------|
| 標籤標題 | 微軟正黑體 | 14pt | Bold |
| 欄位標籤 | 微軟正黑體 | 9pt | Regular |
| 欄位值（一般） | 微軟正黑體 | 10pt | Regular |
| 欄位值（重要） | 微軟正黑體 | 11pt | Bold |
| 條碼下方文字 | 微軟正黑體 | 8pt | Regular |

**字型部署策略：**

| 項目 | 規格 |
|------|------|
| 部署方式 | **PDF 輸出時嵌入字型（Embed）** |
| 嵌入範圍 | 微軟正黑體 Regular + Bold |
| 優點 | 任何環境開啟 PDF 皆能正確顯示 |
| 注意事項 | PDF 檔案大小會稍微增加 |

---

## 6. 條碼規格

### 6.1 一維條碼 (Barcode)

| 項目 | 規格 |
|------|------|
| 類型 | Code 128 |
| 高度 | 10mm |
| Quiet Zone | 左右各 10 倍最小單元寬度，**不可裁切**（由 library 參數控制） |
| 下方文字 | 顯示編碼內容，字型 8pt，位置固定於條碼下方置中 |
| 字元限制 | ASCII 0-127（英數字、符號），**不支援中文** |

### 6.2 二維條碼 (QR Code)

| 項目 | 規格 |
|------|------|
| 類型 | QR Code |
| 尺寸 | 20mm x 20mm |
| 容錯等級 | Level M（15%） |
| Quiet Zone | 四周各 4 倍單元寬度，**不可裁切**（由 library 參數控制） |
| 編碼格式 | UTF-8（**支援中文**） |
| 下方文字 | 不顯示 |
| 分隔符號 | 分號 `;` |

**QR Code 編碼範例：**

```
511-251020041;FC7800280H-00000-00005;6733;00U35NVVR
```

**組合欄位規則：**

| 項目 | 規則 |
|------|------|
| 欄位語法 | `{資料源欄位名}`，如 `{pono}` |
| 分隔符號 | 使用分號 `;` 串接 |
| 資料限制 | 欄位值**禁止包含分號**，匯入時檢查並警告 |
| 空值處理 | 欄位為空時輸出空字串，保留分號位置 |

---

## 7. 非功能需求

| 項目 | 規格 |
|------|------|
| 執行環境 | Windows 10/11 |
| 開發框架 | C# WPF (.NET 8 LTS) |
| 架構模式 | MVVM |
| 字型 | 微軟正黑體 |
| 標籤尺寸 | 100mm x 60mm |
| PDF 解析度 | 300 DPI |
| 條碼品質 | 須通過條碼機/手機掃描驗證 |
| 軟體獨立性 | 不依賴付費軟體（CodeSoft、BarTender），使用開源 Library |

### 7.1 NuGet 套件選用

| 用途 | 套件名稱 | 授權 | 費用 |
|------|----------|------|------|
| MVVM 框架 | CommunityToolkit.Mvvm | MIT | 免費 |
| Excel 讀取 | ExcelDataReader | MIT | 免費 |
| 條碼生成 | ZXing.Net | Apache 2.0 | 免費 |
| PDF 輸出 | QuestPDF | Community License | 免費* |

> *QuestPDF Community License：年營收 < 100 萬美金免費，正式上線再評估授權。

### 7.2 專案架構

```
NanmaoLabel/
├── NanmaoLabel.sln
├── NanmaoLabelPOC/                    # 主程式 (WPF)
│   ├── Views/                         # XAML 畫面
│   │   ├── MainWindow.xaml            # 主視窗（分頁容器）
│   │   ├── LabelPrintView.xaml        # 標籤列印分頁
│   │   └── DataManageView.xaml        # 資料管理分頁
│   ├── ViewModels/                    # MVVM ViewModel
│   │   ├── MainViewModel.cs
│   │   ├── LabelPrintViewModel.cs
│   │   └── DataManageViewModel.cs
│   ├── Models/                        # 資料模型
│   │   ├── LabelTemplate.cs           # 標籤格式定義
│   │   ├── LabelField.cs              # 欄位定義
│   │   └── DataRecord.cs              # 資料紀錄
│   ├── Services/                      # 商業邏輯
│   │   ├── IExcelImporter.cs          # Excel 匯入介面
│   │   ├── ExcelImporter.cs           # Excel 讀取實作
│   │   ├── IDataStore.cs              # 資料儲存介面
│   │   ├── DataStore.cs               # JSON 讀寫實作
│   │   ├── ILabelRenderer.cs          # 標籤渲染介面
│   │   ├── LabelRenderer.cs           # 標籤渲染實作
│   │   ├── IBarcodeGenerator.cs       # 條碼生成介面
│   │   ├── BarcodeGenerator.cs        # 條碼生成實作
│   │   ├── IPdfExporter.cs            # PDF 輸出介面
│   │   └── PdfExporter.cs             # PDF 輸出實作
│   ├── Templates/                     # 內建標籤格式
│   │   └── BuiltInTemplates.cs        # QW075551-1、QW075551-2 定義
│   ├── Converters/                    # XAML 值轉換器
│   ├── Resources/                     # 資源檔
│   ├── App.xaml
│   └── App.xaml.cs
├── NanmaoLabelPOC.Tests/              # 單元測試專案
│   ├── Services/
│   │   ├── ExcelImporterTests.cs      # Excel 匯入測試
│   │   ├── DataStoreTests.cs          # JSON 讀寫測試
│   │   ├── BarcodeGeneratorTests.cs   # 條碼生成測試
│   │   └── LabelRendererTests.cs      # 標籤渲染測試
│   └── NanmaoLabelPOC.Tests.csproj
└── samples/                           # 範例檔案
    └── MockData.xlsx                  # 模擬資料範例
```

> **備註**：需求規格書存放於 `.dao/raw_spec.md`（專案配置目錄），不納入原始碼專案結構。

---

## 8. 畫面規劃

### 8.1 設計原則

本系統主要供**產線操作員**使用，採用 **Kiosk 風格**設計，強調易於瀏覽與操作。

**Kiosk 設計原則：**

| 原則 | 說明 |
|------|------|
| 大按鈕 | 方便觸控操作 |
| 大字體 | 清晰易讀 |
| 高對比 | 深色文字 + 淺色背景 |
| 簡化操作 | 減少步驟，一目瞭然 |
| 自適應 | 16:9 比例，支援不同解析度 |

**螢幕規格：**

| 項目 | 規格 |
|------|------|
| 螢幕比例 | 16:9 橫式 |
| 建議解析度 | 1920 x 1080 (Full HD) |
| 最小解析度 | 1024 x 576 |
| 縮放方式 | 自適應等比縮放 |

### 8.2 整體佈局結構

系統採用分頁設計，分為「標籤列印」（操作員）與「資料管理」（管理者）兩個功能區。

**自訂標題列：** 採用 WindowStyle="None" 無系統邊框，自行繪製標題列以達成 Kiosk 風格。

```
┌─────────────────────────────────────────────────────────────────┐
│  自訂標題列                                           Height: 40 │
├─────────────────────────────────────────────────────────────────┤
│  分頁標籤列                                           Height: 50 │
├─────────────────────────────────────────────────────────────────┤
│                         主內容區                         1*     │
├─────────────────────────────────────────────────────────────────┤
│  狀態列                                               Height: 30 │
└─────────────────────────────────────────────────────────────────┘
```

**Grid 比例配置（MainWindow）：**

| Row | 高度 | 內容 |
|-----|------|------|
| 0 | 40 (固定) | 自訂標題列 |
| 1 | 50 (固定) | 分頁標籤 |
| 2 | 1* (自適應) | 分頁內容 |
| 3 | 30 (固定) | 狀態列 |

### 8.3 自訂標題列規格

**一般模式：**

```
┌────────────────────────────────────────────────────────────────────────────────────────┐
│  🏭 南茂標籤列印系統                                        [全螢幕 F11]  [─]  [□]  [✕] │
└────────────────────────────────────────────────────────────────────────────────────────┘
```

**全螢幕模式（Kiosk）：**

```
┌────────────────────────────────────────────────────────────────────────────────────────┐
│  🏭 南茂標籤列印系統                                              [結束全螢幕 F11/ESC] │
└────────────────────────────────────────────────────────────────────────────────────────┘
```

**標題列樣式：**

| 項目 | 規格 |
|------|------|
| 視窗樣式 | WindowStyle="None"（無系統邊框） |
| 標題列高度 | 40px |
| 背景色 | 深藍 #1E3A5F |
| 文字色 | 白色 #FFFFFF |
| Logo/Icon | 🏭 或自訂圖示（24x24） |
| 標題字體 | 18pt Bold |

**標題列按鈕（一般模式）：**

| 按鈕 | 尺寸 | 功能 | 快捷鍵 | Hover 背景色 |
|------|------|------|--------|--------------|
| [全螢幕 F11] | 100 x 40 | 切換全螢幕模式 | F11 | #2E4A6F |
| [─] | 46 x 40 | 最小化 | - | #2E4A6F |
| [□] | 46 x 40 | 最大化/還原 | - | #2E4A6F |
| [✕] | 46 x 40 | 關閉程式 | Alt+F4 | #E81123 |

**標題列按鈕（全螢幕模式）：**

| 按鈕 | 尺寸 | 功能 | 快捷鍵 | Hover 背景色 |
|------|------|------|--------|--------------|
| [結束全螢幕 F11/ESC] | 160 x 40 | 離開全螢幕 | F11 或 ESC | #2E4A6F |

**視窗行為：**

| 功能 | 說明 |
|------|------|
| 拖曳移動 | 標題列區域（按鈕以外）可拖曳移動視窗 |
| 雙擊最大化 | 雙擊標題列切換最大化/還原 |
| 全螢幕模式 | WindowState="Maximized" + 隱藏工作列，僅顯示 [結束全螢幕] |
| 邊框調整 | ResizeMode="CanResize"，支援拖曳邊框調整視窗大小 |
| 最小視窗 | MinWidth: 1024px, MinHeight: 576px |
| ESC 鍵 | 全螢幕模式下按 ESC 可離開全螢幕 |

### 8.4 分頁一：標籤列印（操作員主介面）

```
┌────────────────────────────────────────────────────────────────────────────────────────┐
│  🏭 南茂標籤列印系統                                        [全螢幕 F11]  [─]  [□]  [✕] │
├────────────────────────────────────────────────────────────────────────────────────────┤
│  ┌────────────────────┐ ┌────────────────────┐                                         │
│  │   📋 標籤列印      │ │   ⚙️ 資料管理      │                                         │
│  └────────────────────┘ └────────────────────┘                                         │
├──────────────────────────────────┬─────────────────────────────────────────────────────┤
│                                  │                                                     │
│    ┌──────────────────────────┐  │   ┌─────────────────────────────────────────────┐   │
│    │                          │  │   │  📦 G25A111577 │ XinshengIntel │ 6,733     │◀──│── 選取中
│    │                          │  │   ├─────────────────────────────────────────────┤   │
│    │                          │  │   │  📦 G25C105479 │ XinshengIntel │ 9,120     │   │
│    │                          │  │   ├─────────────────────────────────────────────┤   │
│    │      標籤預覽區          │  │   │  📦 G25C092200 │ XinshengIntel │ 7,600     │   │
│    │      (即時預覽)          │  │   ├─────────────────────────────────────────────┤   │
│    │                          │  │   │  📦 G25C092206 │ XinshengIntel │ 1,367     │   │
│    │                          │  │   ├─────────────────────────────────────────────┤   │
│    │                          │  │   │  📦 G25C092210 │ XinshengIntel │ 2,450     │   │
│    │                          │  │   ├─────────────────────────────────────────────┤   │
│    │                          │  │   │  📦 G25C092215 │ XinshengIntel │ 3,200     │   │
│    │                          │  │   └─────────────────────────────────────────────┘   │
│    │                          │  │                                                     │
│    └──────────────────────────┘  │                    ◀  1 / 2  ▶                      │
│                                  │                                                     │
├──────────────────────────────────┼─────────────────────────────────────────────────────┤
│                                  │                                                     │
│   標籤格式                       │  ┌───────────────────┐   ┌───────────────────────┐  │
│   ┌────────────────────────┐     │  │                   │   │                       │  │
│   │   QW075551-1        ▼  │     │  │   📄 輸出 PDF    │   │   📑 批次輸出全部     │  │
│   └────────────────────────┘     │  │                   │   │                       │  │
│                                  │  └───────────────────┘   └───────────────────────┘  │
│                                  │                                                     │
├──────────────────────────────────┴─────────────────────────────────────────────────────┤
│  ✅ 就緒                                                              共 10 筆資料    │
└────────────────────────────────────────────────────────────────────────────────────────┘
```

**Grid 比例配置（標籤列印分頁）：**

| Column | 寬度 | 內容 |
|--------|------|------|
| 0 | 45* | 標籤預覽區 + 格式選擇 |
| 1 | 55* | 資料清單 + 操作按鈕 |

| Row (左側) | 高度 | 內容 |
|------------|------|------|
| 0 | 1* | 標籤預覽區 |
| 1 | 70 (固定) | 格式下拉選單 |

| Row (右側) | 高度 | 內容 |
|------------|------|------|
| 0 | 1* | 資料清單 (ListView) |
| 1 | Auto | 分頁指示器 |
| 2 | 70 (固定) | 操作按鈕 |

**元件說明：**

| 區域 | 元件 | 說明 |
|------|------|------|
| 左側上方 | 標籤預覽區 | 即時渲染標籤樣式，佔左側主要空間 |
| 左側下方 | 標籤格式下拉選單 | 切換 QW075551-1 / QW075551-2 |
| 右側上方 | ListView | 顯示交易資料清單，大字體、高行高 |
| 右側中間 | 分頁指示器 | ◀ ▶ 按鈕 + 頁碼 |
| 右側下方 | 操作按鈕 | [輸出 PDF]、[批次輸出全部] |
| 底部 | 狀態列 | 顯示狀態與資料筆數 |

**標籤預覽區規格：**

| 項目 | 規格 |
|------|------|
| 縮放方式 | 等比縮放置中，保持標籤比例 (100:60) |
| 背景色 | 淺灰 #F5F5F5 |
| 邊框 | 1px 實線 #E0E0E0 |
| 標籤背景 | 白色 #FFFFFF |
| 標籤陰影 | 輕微陰影效果，增加立體感 |

**ListView 規格：**

| 項目 | 規格 |
|------|------|
| 每頁筆數 | 依視窗高度自動計算（項目高度 50px） |
| 顯示欄位 | 📦 單據編號 │ 客戶名稱 │ 數量 |
| 項目高度 | 50px |
| 選取樣式 | 背景色 #0078D4（主題藍），文字白色 |
| 未選取樣式 | 背景色 #FFFFFF，文字 #333333 |
| Hover 樣式 | 背景色 #F0F0F0 |

**空白狀態（無資料時）：**

```
┌──────────────────────────────────┬─────────────────────────────────────────────────────┐
│                                  │                                                     │
│    ┌──────────────────────────┐  │   ┌─────────────────────────────────────────────┐   │
│    │                          │  │   │                                             │   │
│    │                          │  │   │                                             │   │
│    │      📋                  │  │   │           📂 尚無資料                       │   │
│    │      請先匯入資料        │  │   │                                             │   │
│    │      或選取資料項目      │  │   │     請至「資料管理」分頁匯入 Excel         │   │
│    │                          │  │   │                                             │   │
│    │                          │  │   │                                             │   │
│    └──────────────────────────┘  │   └─────────────────────────────────────────────┘   │
│                                  │                                                     │
└──────────────────────────────────┴─────────────────────────────────────────────────────┘
```

| 元件 | 空白狀態行為 |
|------|--------------|
| 預覽區 | 顯示「📋 請先匯入資料或選取資料項目」提示文字（置中、灰色） |
| ListView | 顯示「📂 尚無資料，請至「資料管理」分頁匯入 Excel」提示文字 |
| [輸出 PDF] | 停用狀態 |
| [批次輸出全部] | 停用狀態 |

### 8.5 分頁二：資料管理（管理者介面）

```
┌────────────────────────────────────────────────────────────────────────────────────────┐
│  🏭 南茂標籤列印系統                                        [全螢幕 F11]  [─]  [□]  [✕] │
├────────────────────────────────────────────────────────────────────────────────────────┤
│  ┌────────────────────┐ ┌────────────────────┐                                         │
│  │   📋 標籤列印      │ │   ⚙️ 資料管理      │                                         │
│  └────────────────────┘ └────────────────────┘                                         │
├────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                        │
│   ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐               │
│   │  📥 匯入     │  │  ➕ 新增     │  │  🗑️ 刪除     │  │  💾 儲存     │               │
│   └──────────────┘  └──────────────┘  └──────────────┘  └──────────────┘               │
│                                                                                        │
├────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                        │
│   ┌────────────────────────────────────────────────────────────────────────────────┐   │
│   │ 單據編號       │ 客戶名稱           │ 客戶料號        │ 日期       │ 數量     │   │
│   ├────────────────┼────────────────────┼─────────────────┼────────────┼──────────┤   │
│   │ [G25A111577 ] │ [XinshengIntel   ] │ [XPA72EA0I-008] │ [2025-11-14] │ [6733 ] │   │
│   ├────────────────┼────────────────────┼─────────────────┼────────────┼──────────┤   │
│   │ [G25C105479 ] │ [XinshengIntel   ] │ [XPA72EA0I-009] │ [2025-11-15] │ [9120 ] │   │
│   ├────────────────┼────────────────────┼─────────────────┼────────────┼──────────┤   │
│   │ [G25C092200 ] │ [XinshengIntel   ] │ [XPA72EA0I-010] │ [2025-11-16] │ [7600 ] │   │
│   └────────────────────────────────────────────────────────────────────────────────┘   │
│                                                                                        │
├────────────────────────────────────────────────────────────────────────────────────────┤
│   欄位編輯                                                                             │
│   ┌──────────────────────────────────────┐  ┌──────────────────────────────────────┐   │
│   │ 單據編號:    [G25A111577          ] │  │ 製令單號:    [511-251020041        ] │   │
│   │ 客戶名稱:    [XinshengIntelligent ] │  │ 裝置編號:    [FC7800280H-00000     ] │   │
│   │ 客戶料號:    [XPA72EA0I-008       ] │  │ 備註:        [00U35NVVR            ] │   │
│   │ 客戶 P/N:    [E110-X0             ] │  │ ERP 料號:    [4D010018             ] │   │
│   │ 日期:        [2025-11-14          ] │  │ 客戶採購單號: [P600-X1725A3002627  ] │   │
│   │ 數量:        [6733                ] │  │                                      │   │
│   └──────────────────────────────────────┘  └──────────────────────────────────────┘   │
├────────────────────────────────────────────────────────────────────────────────────────┤
│  ⚠️ 已修改（未儲存）                                                   共 10 筆資料   │
└────────────────────────────────────────────────────────────────────────────────────────┘
```

**Grid 比例配置（資料管理分頁）：**

| Row | 高度 | 內容 |
|-----|------|------|
| 0 | 60 (固定) | 工具列 |
| 1 | 60* | DataGrid |
| 2 | 40* | 欄位編輯區 |

**元件說明：**

| 區域 | 元件 | 說明 |
|------|------|------|
| 工具列 | [匯入] 按鈕 | 從 Excel 匯入資料 |
| 工具列 | [新增] 按鈕 | 新增一筆空白資料列 |
| 工具列 | [刪除] 按鈕 | 刪除選取的資料列 |
| 工具列 | [儲存] 按鈕 | 儲存變更至 data.json |
| 中間 | DataGrid | 可直接在表格內編輯（inline editing） |
| 下方 | 欄位編輯區 | 選取資料列後顯示完整欄位（兩欄排列） |
| 底部 | 狀態列 | 顯示修改狀態與資料筆數 |

### 8.6 自適應元件規格

**響應式尺寸定義：**

| 元件 | 最小尺寸 | 建議尺寸 | 縮放方式 |
|------|----------|----------|----------|
| 視窗 | 1024 x 576 | 1920 x 1080 | 等比縮放 |
| 分頁標籤 | 高 40px | 高 50px | 固定高度，寬度自適應 |
| ListView 項目 | 高 40px | 高 50px | 固定高度，寬度填滿 |
| 按鈕（主要） | 100 x 40 | 140 x 50 | 最小尺寸 + Stretch |
| 按鈕（工具列） | 80 x 36 | 110 x 45 | 最小尺寸 + Stretch |
| 下拉選單 | 高 36px | 高 40px | 固定高度，寬度自適應 |
| 輸入欄位 | 高 30px | 高 36px | 固定高度，寬度自適應 |
| 分頁按鈕 (◀ ▶) | 40 x 40 | 50 x 50 | 固定尺寸 |

**字體縮放基準：**

| 視窗寬度 | 基準字體 | 標題 | 按鈕 | 清單項目 | 標籤 |
|----------|----------|------|------|----------|------|
| ≥ 1920px | 14pt | 18pt Bold | 14pt Bold | 14pt | 12pt |
| ≥ 1366px | 13pt | 16pt Bold | 13pt Bold | 13pt | 11pt |
| ≥ 1024px | 12pt | 14pt Bold | 12pt Bold | 12pt | 10pt |

**觸控友善設計：**

| 項目 | 規格 |
|------|------|
| 最小點擊區域 | 44 x 44 px |
| 按鈕間距 | 至少 8px |
| 清單項目間距 | 至少 4px |
| 捲動條寬度 | 至少 16px |

### 8.7 操作流程

```
┌─────────────────────────────────────────────────────────────────────┐
│                          日常使用流程                               │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│   1. 程式啟動 → 自動載入 data.json                                  │
│         │                                                           │
│         ▼                                                           │
│   2. 「標籤列印」分頁顯示資料清單                                   │
│         │                                                           │
│         ▼                                                           │
│   3. 單擊項目 → 左側即時預覽標籤                                    │
│         │                                                           │
│         ├──→ [輸出 PDF] → 輸出當前標籤                              │
│         │                                                           │
│         └──→ 雙擊項目 → 直接輸出該筆標籤 PDF                        │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────┐
│                       現場展示流程（證明 POC 真實性）                │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│   1. 切換到「資料管理」分頁                                         │
│         │                                                           │
│         ▼                                                           │
│   2. 點擊 [新增] → 新增一筆空白資料                                 │
│         │                                                           │
│         ▼                                                           │
│   3. 在欄位編輯區輸入資料（或直接在 DataGrid 編輯）                 │
│         │                                                           │
│         ▼                                                           │
│   4. 點擊 [儲存] → 儲存至 data.json                                 │
│         │                                                           │
│         ▼                                                           │
│   5. 切換到「標籤列印」分頁                                         │
│         │                                                           │
│         ▼                                                           │
│   6. 選取剛新增的資料 → 即時預覽標籤                                │
│         │                                                           │
│         ▼                                                           │
│   7. 點擊 [輸出 PDF] → 產出該筆標籤                                 │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

### 8.8 操作行為定義

**標籤列印分頁：**

| 操作 | 行為 |
|------|------|
| 單擊 ListView 項目 | 左側預覽區即時顯示該筆資料的標籤 |
| 雙擊 ListView 項目 | 直接將該筆標籤輸出為 PDF（快捷操作） |
| 點擊 [輸出 PDF] | 將當前預覽的標籤輸出為 PDF |
| 點擊 [批次輸出全部] | 將所有資料輸出為多頁 PDF |
| 切換標籤格式 | 預覽區即時更新為新格式 |
| 點擊 ◀ ▶ | 切換資料清單頁面 |

**雙擊事件處理（避免 WPF 雙擊地獄）：**

| 規則 | 說明 |
|------|------|
| 允許行為 | 雙擊前先觸發單擊（先預覽再輸出） |
| 禁止行為 | 雙擊被判成兩次單擊導致不輸出或輸出兩次 |
| 實作建議 | 使用 `e.ClickCount == 2` 判斷，或設定防抖（debounce）機制 |

**PDF 輸出成功回饋：**

| 項目 | 規格 |
|------|------|
| 狀態列訊息 | `✅ PDF 已輸出：{完整檔案路徑}` |
| 批次完成 | 顯示對話框，可選擇「開啟資料夾」或「確定」 |

**資料管理分頁：**

| 操作 | 行為 |
|------|------|
| 點擊 [匯入] | 開啟檔案對話框，選擇 Excel 匯入（覆蓋現有資料） |
| 點擊 [新增] | 在 DataGrid 新增一筆空白資料列 |
| 點擊 [刪除] | 刪除目前選取的資料列（需確認） |
| 點擊 [儲存] | 將所有變更儲存至 data.json |
| 選取 DataGrid 項目 | 下方欄位編輯區顯示該筆完整資料 |
| 編輯欄位 | DataGrid 與欄位編輯區雙向同步 |

### 8.9 錯誤處理規範

**檔案操作錯誤：**

| 錯誤情境 | 錯誤訊息 | 處理方式 |
|----------|----------|----------|
| Excel 檔案不存在 | 「找不到指定的檔案」 | 顯示錯誤對話框，返回原畫面 |
| Excel 格式錯誤 | 「檔案格式不正確，請確認為 .xlsx 格式」 | 顯示錯誤對話框，返回原畫面 |
| Excel 欄位缺失 | 「缺少必要欄位：{欄位名稱}」 | 顯示警告對話框，列出缺少欄位 |
| data.json 讀取失敗 | 「無法載入資料檔案」 | 顯示錯誤對話框，程式以空白狀態啟動 |
| data.json 儲存失敗 | 「儲存失敗，請確認檔案未被其他程式佔用」 | 顯示錯誤對話框，資料保留在記憶體 |
| PDF 輸出失敗 | 「PDF 輸出失敗：{錯誤原因}」 | 顯示錯誤對話框 |
| PDF 檔案已存在 | 「檔案已存在，是否覆蓋？」 | 顯示確認對話框（是/否） |

**資料驗證錯誤：**

| 錯誤情境 | 錯誤訊息 | 處理方式 |
|----------|----------|----------|
| 必填欄位為空 | 「請填寫必要欄位：{欄位名稱}」 | 欄位標示紅框，焦點移至該欄位 |
| 資料格式錯誤 | 「{欄位名稱} 格式不正確」 | 欄位標示紅框，顯示提示 |
| 無資料可輸出 | 「沒有可輸出的資料」 | 顯示提示訊息 |
| 未選取資料 | 「請先選取要輸出的資料」 | 顯示提示訊息 |

**操作確認：**

| 操作 | 確認訊息 | 按鈕 |
|------|----------|------|
| 刪除資料 | 「確定要刪除選取的資料嗎？此操作無法復原。」 | [確定] [取消] |
| 匯入覆蓋 | 「匯入將覆蓋現有資料，是否繼續？」 | [確定] [取消] |
| 未儲存離開 | 「資料尚未儲存，是否要儲存變更？」 | [儲存] [不儲存] [取消] |
| 切換分頁（未儲存） | 「資料尚未儲存，是否要儲存變更？」 | [儲存] [不儲存] [取消] |

### 8.10 UI 細節規範

**按鈕狀態：**

| 按鈕 | 啟用條件 | 停用條件 |
|------|----------|----------|
| [匯入] | 永遠啟用 | - |
| [新增] | 永遠啟用 | - |
| [刪除] | 有選取資料列 | 無選取資料列 |
| [儲存] | 資料有變更 | 資料無變更 |
| [輸出 PDF] | 有選取資料且預覽成功 | 無選取資料或預覽失敗 |
| [批次輸出全部] | 資料列數 > 0 | 資料列數 = 0 |
| 標籤格式下拉選單 | 永遠啟用 | - |
| ◀ (上一頁) | 目前頁 > 1 | 目前頁 = 1 |
| ▶ (下一頁) | 目前頁 < 總頁數 | 目前頁 = 總頁數 |

**狀態列訊息：**

| 狀態 | 訊息格式 |
|------|----------|
| 就緒 | 「✅ 就緒　共 {n} 筆資料」 |
| 載入中 | 「⏳ 載入中...」 |
| 匯入成功 | 「✅ 匯入成功，共 {n} 筆資料」 |
| 儲存成功 | 「✅ 儲存成功」 |
| 資料已修改 | 「⚠️ 已修改（未儲存）　共 {n} 筆資料」 |
| PDF 輸出成功 | 「✅ PDF 已輸出：{檔案路徑}」 |
| 錯誤 | 「❌ {錯誤訊息}」 |

**對話框標題：**

| 類型 | 標題 |
|------|------|
| 開啟檔案 | 「選擇 Excel 檔案」 |
| 儲存 PDF | 「儲存 PDF 檔案」 |
| 錯誤訊息 | 「錯誤」 |
| 警告訊息 | 「警告」 |
| 確認訊息 | 「確認」 |
| 提示訊息 | 「提示」 |

**檔案對話框篩選：**

| 對話框 | 篩選條件 |
|--------|----------|
| 匯入 Excel | Excel 檔案 (*.xlsx)|*.xlsx |
| 儲存 PDF | PDF 檔案 (*.pdf)|*.pdf |

**預設檔名：**

| 輸出類型 | 預設檔名格式 |
|----------|--------------|
| 單筆 PDF | `Label_{單據編號}_{日期時間}.pdf` |
| 批次 PDF | `Labels_Batch_{日期時間}.pdf` |

**日期時間格式：** `yyyyMMdd_HHmmss`（例：20250126_143052）

---

## 9. 測試情境

### 9.1 標籤列印測試

| 編號 | 測試項目 | 輸入條件 | 預期結果 | 驗證方式 |
|------|----------|----------|----------|----------|
| TC-01 | JSON 自動載入 | 程式啟動時存在 data.json | ListView 自動顯示資料 | 目視檢查 |
| TC-02 | 變數對應 | nvr_cust = "TSMC" | CSCUSTOMER 顯示 "TSMC" | 目視檢查 |
| TC-03 | 常數值處理 | QW075551-2 格式 | CSNUMBER 顯示 "17008" | 目視檢查 |
| TC-04 | 缺值處理 | 資料源缺少 ogd09 欄位 | 程式不崩潰，欄位顯示空白或提示 | 程式執行 |
| TC-05 | 標籤格式切換 | 切換 QW075551-1 / QW075551-2 | 畫面正確顯示對應格式 | 目視檢查 |
| TC-06 | 單擊預覽 | 單擊 ListView 項目 | 上方預覽區顯示該筆標籤 | 目視檢查 |
| TC-07 | 雙擊輸出 | 雙擊 ListView 項目 | 直接輸出該筆標籤 PDF | 檢查 PDF 檔案 |
| TC-08 | 一維條碼掃描 | CSCUSTPN = "E110-X0" | 顯示 Code 128 條碼 | **手機/掃描槍掃描成功** |
| TC-09 | QR Code 掃描 | 組合欄位值 | 顯示 QR Code | **手機/掃描槍掃描成功** |
| TC-10 | PDF 輸出 | 點擊 [輸出 PDF] | 產生 PDF 檔案，內容與預覽一致 | 開啟 PDF 檢查 |
| TC-11 | PDF 條碼掃描 | 掃描 PDF 上的條碼 | 條碼內容正確 | **手機/掃描槍掃描成功** |
| TC-12 | 批次輸出 | 點擊 [批次輸出全部] | 產生包含多頁標籤的 PDF | 開啟 PDF 檢查 |

### 9.2 資料管理測試

| 編號 | 測試項目 | 輸入條件 | 預期結果 | 驗證方式 |
|------|----------|----------|----------|----------|
| TC-13 | 資料源匯入 | 匯入 Data.xlsx | 產生 data.json，資料完整 | 檢查 JSON 檔案 |
| TC-14 | 新增資料 | 點擊 [新增] | DataGrid 新增一筆空白列 | 目視檢查 |
| TC-15 | 編輯資料 | 修改欄位值 | DataGrid 與編輯區同步更新 | 目視檢查 |
| TC-16 | 刪除資料 | 選取後點擊 [刪除] | 資料列被移除 | 目視檢查 |
| TC-17 | 儲存資料 | 點擊 [儲存] | 變更寫入 data.json | 檢查 JSON 檔案 |
| TC-18 | 新增後列印 | 新增資料 → 儲存 → 切換分頁 → 選取 → 輸出 | 新資料正確顯示於標籤並輸出 PDF | **現場展示** |

---

## 10. 驗收標準

> **POC 驗收三要素（同時成立方為通過）：**
> 1. **可掃描**：所有條碼/QR Code 可被手機或掃描槍穩定掃描
> 2. **內容正確**：掃描結果與資料源一致
> 3. **版面一致**：預覽畫面與 PDF 輸出版面一致

### 10.1 標籤列印驗收

| 編號 | 驗收項目 | 通過條件 |
|------|----------|----------|
| A-01 | JSON 自動載入 | 程式啟動時自動載入並顯示資料 |
| A-02 | 變數對應 | 資料源欄位值正確顯示於標籤 |
| A-03 | 常數值處理 | 固定值正確顯示（如 "17008"） |
| A-04 | 標籤預覽 | 畫面顯示內容與格式定義一致 |
| A-05 | 格式切換 | 兩種標籤格式皆能正確顯示 |
| A-06 | 單擊預覽 | 單擊 ListView 項目即時預覽標籤 |
| A-07 | 雙擊輸出 | 雙擊 ListView 項目直接輸出 PDF |
| A-08 | 一維條碼 | Code 128 條碼可被掃描，內容正確 |
| A-09 | QR Code | QR Code 可被掃描，內容正確 |
| A-10 | PDF 輸出 | PDF 版面與預覽一致 |
| A-11 | PDF 條碼 | PDF 上的條碼可被掃描 |
| A-12 | 批次輸出 | 多筆資料正確輸出至單一 PDF |

### 10.2 資料管理驗收

| 編號 | 驗收項目 | 通過條件 |
|------|----------|----------|
| A-13 | 資料源匯入 | Excel 正確解析並儲存為 data.json |
| A-14 | 新增資料 | 可新增空白資料列並編輯 |
| A-15 | 編輯資料 | DataGrid 與欄位編輯區雙向同步 |
| A-16 | 刪除資料 | 可刪除選取的資料列 |
| A-17 | 儲存資料 | 變更正確儲存至 data.json |
| A-18 | 新增後列印 | 新增的資料可正確產生標籤與 PDF |

---

## 11. POC 預期產出物

| 項目 | 說明 |
|------|------|
| 執行檔 | `NanmaoLabelPOC.exe`（Portable / 免安裝） |
| 資料源範例 | `MockData.xlsx`（模擬交易資料） |
| JSON 範例 | `data.json`（程式產生的本地快取） |
| PDF 樣本 | 程式產出的 PDF 標籤範例 |
| 原始碼 | 完整 C# 專案原始碼 |

---

## 12. 待下一階段處理

| 項目 | 說明 |
|------|------|
| 搜尋/篩選功能 | 資料量大時快速搜尋目標資料 |
| 設定檔匯入 | 將內建標籤格式改為外部設定檔驅動 |
| 欄位彈性設定 | UI 介面讓使用者自行配對欄位對應 |
| 標籤格式編輯器 | 視覺化拖拉調整標籤版面 |
| 複雜邏輯處理 | 支援 If-Else、運算式等進階邏輯 |
| 資料庫連接 | 改為從 Oracle/SAP HANA 取得資料 |
| 實際列印 | 連接標籤印表機（Zebra、TSC 等） |

---

## 13. 實作約束與一致性規範

> ⚠️ **本節為 POC 實作一致性強制規範。若與其他段落描述衝突，以本節為準。**

### 13.1 座標與尺寸（唯一真相）

| 項目 | 規範 |
|------|------|
| 座標單位 | **mm 為唯一真相**（規格表格中的 X/Y/Width/Height 皆為 mm） |
| 內部座標系 | 建議統一使用 pt（PDF 點，便於 PDF 輸出） |
| 渲染一致性 | **預覽與 PDF 輸出必須共用同一套渲染定位邏輯** |

**換算公式：**

| 轉換 | 公式 | 範例 |
|------|------|------|
| mm → pt | `pt = mm × 72 ÷ 25.4` | 100mm = 283.46pt |
| mm → px@300DPI | `px = mm × 300 ÷ 25.4` | 100mm = 1181.1px |

**渲染一致性要求：**

| 允許 | 不允許 |
|------|--------|
| 預覽為近似（抗鋸齒/縮放差異） | 預覽位置與 PDF 位置不一致造成欄位跑版 |

### 13.2 字型與文字處理

| 項目 | 規範 |
|------|------|
| 字型 | 微軟正黑體（Bold / Regular） |
| 部署策略 | **PDF 輸出時嵌入字型（Embed）** |
| 日期格式 | 固定為 `yyyy-MM-dd`，不得自行更改 |

**文字溢出處理（統一策略，不得各欄位自行發揮）：**

| 順序 | 處理 |
|------|------|
| 1 | 先裁切（Trim + Ellipsis 或硬截斷） |
| 2 | 不自動換行（除非欄位明確允許） |
| 3 | 不自動縮字（除非欄位明確允許） |

### 13.3 條碼/QR Code（掃得到是第一性原理）

| 項目 | 規範 |
|------|------|
| 一維條碼 | Code 128 |
| 二維條碼 | QR Code |
| Quiet Zone | **必須保留，不得裁切**（由 library 參數控制） |
| 條碼下方文字 | 固定顯示，字型 8pt，位置置中 |
| 驗收底線 | **任何條碼或 QR Code 無法被手機/掃描槍穩定掃描，即視為不通過** |

### 13.4 組合欄位（QR Code Pattern）規則

| 項目 | 規範 |
|------|------|
| 分隔符號 | 固定為分號 `;` |
| 欄位順序 | 固定為模板定義之順序，不得調換 |
| 空值處理 | **保留欄位位置**（例如 `A;;C`） |
| Trim 空白 | 欄位值必須 Trim 前後空白 |
| 分號處理 | 欄位值**禁止包含分號**，匯入時報錯警告 |

### 13.5 資料匯入與儲存

| 項目 | 規範 |
|------|------|
| 匯入策略 | **覆蓋模式（Overwrite）**，整份取代 |
| 匯入後落地 | 成功後必須儲存 `data.json` |
| 程式啟動 | 必須自動載入 `data.json` |
| lastModified | 必須更新為當次儲存時間（ISO 8601） |

### 13.6 UI 互動行為

**標籤列印分頁：**

| 操作 | 規範 |
|------|------|
| 單擊 ListView | **只做預覽更新** |
| 雙擊 ListView | **只觸發一次輸出**（允許雙擊前先觸發單擊） |
| 禁止行為 | 雙擊被判成兩次單擊導致不輸出/輸出兩次 |

**PDF 輸出回饋：**

| 項目 | 規範 |
|------|------|
| 狀態列 | `✅ PDF 已輸出：{檔案路徑}` |
| 預設檔名 | 單筆：`Label_{單據編號}_{yyyyMMdd_HHmmss}.pdf` |
| 預設檔名 | 批次：`Labels_Batch_{yyyyMMdd_HHmmss}.pdf` |

### 13.7 測試與驗收

**最低測試要求：**

| 測試項目 | 說明 |
|----------|------|
| 單筆輸出 PDF | 驗證單一標籤輸出 |
| 批次輸出多頁 PDF | 驗證多筆資料整批輸出 |
| 條碼掃描 | PDF 上的 Code 128 / QR Code 可被穩定掃描 |

**驗收準則（三者同時成立）：**

| 項目 | 說明 |
|------|------|
| 可掃描 | 手機/掃描槍可穩定讀取 |
| 內容正確 | 掃描結果與資料源一致 |
| 版面一致 | 預覽畫面與 PDF 輸出版面一致 |

### 13.8 數量欄位的顯示值與編碼值分離原則

> ⚠️ **顯示格式與編碼內容必須分離處理**

| 項目 | 規範 |
|------|------|
| 畫面顯示 | 可加入千分位符號（如 `6733 → 6,733`） |
| 標籤文字 | 可加入千分位符號（提升可讀性） |
| **Barcode 編碼** | **一律使用原始數值（不含千分位）** |
| **QR Code 編碼** | **一律使用原始數值（不含千分位）** |

**禁止行為：**

| 禁止 | 說明 |
|------|------|
| 條碼內含 `,` | 條碼/QR Code 編碼內容禁止包含千分位符號 |
| 格式化數值入碼 | 顯示格式僅影響 UI 與標籤文字，不得影響編碼內容 |

### 13.9 條碼與 QR Code 禁止使用文字裁切符號

> ⚠️ **Barcode / QRCode 類型欄位不得套用任何裁切處理**

| 欄位類型 | 允許 Ellipsis (`...`) | 允許縮字 | 允許裁切 |
|----------|----------------------|----------|----------|
| Text | ✅ 是 | ❌ 否 | ✅ 是 |
| **Barcode** | **❌ 否** | **❌ 否** | **❌ 否** |
| **QRCode** | **❌ 否** | **❌ 否** | **❌ 否** |

**條碼編碼內容限制：**

| 允許 | 禁止 |
|------|------|
| 原始欄位值（Trim 後） | 裁切後的內容（含 `...`） |
| 空字串 | 格式化後的內容（含 `,`） |

### 13.10 預覽與輸出之權威來源定義

> ⚠️ **PDF 輸出結果為唯一驗收權威來源**

| 項目 | 定位 |
|------|------|
| **PDF 輸出** | **唯一驗收權威來源** |
| 螢幕預覽 | 僅作為操作輔助與即時回饋用途 |

**差異容許規則：**

| 情況 | 判定 |
|------|------|
| 預覽與 PDF 存在極小差異（抗鋸齒、縮放誤差） | ✅ 通過（只要 PDF 符合規範） |
| PDF 輸出符合尺寸、座標與掃描規範 | ✅ 通過 |
| 僅因預覽與 PDF 略有差異 | ❌ **不得視為錯誤** |

### 13.11 Excel 欄位名稱解析限制

> ⚠️ **欄位名稱僅允許英數字，不進行自動修正或容錯**

**解析規則：**

| 項目 | 規範 |
|------|------|
| 大小寫 | **不分大小寫**（ogb19、OGB19、Ogb19 皆可） |
| 允許字元 | 僅限英文字母與數字（A-Z, a-z, 0-9） |

**不進行自動修正的情況：**

| 情況 | 處理 |
|------|------|
| 含底線（如 `ogb_19`） | 視為欄位缺失 |
| 含空白（如 `OGB 19`） | 視為欄位缺失 |
| 含隱藏字元、BOM | 視為欄位缺失 |
| 含特殊符號 | 視為欄位缺失 |

> 不符合欄位命名規範者，依 8.9 錯誤處理規範處理。

### 13.12 規範優先順序聲明

> ⚠️ **本章節（第 13 章）之規範優先於所有其他章節**

| 優先順序 | 說明 |
|----------|------|
| 1（最高） | 第 13 章「實作約束與一致性規範」 |
| 2 | 其他章節（1-12 章、附錄） |

**衝突處理：**

| 情況 | 處理 |
|------|------|
| 其他章節與第 13 章衝突 | **一律以第 13 章為準** |
| 第 13 章未定義之行為 | 由實作者依合理工程判斷處理 |

---

## 13.B 進階實作防歧義規範（工程師翻車封印）

> ⚠️ **本節為避免實作過程中之隱性誤解與偷懶實作，所列規範屬強制遵循，不得自行簡化或合併流程。**

### 13.13 欄位原始值（Raw Value）與顯示值（Display Value）分離原則

> 🔒 **所有資料欄位在處理流程中，必須同時保留兩種值**

**值類型定義：**

| 值類型 | 用途 | 處理規則 |
|--------|------|----------|
| **Raw Value（原始值）** | Barcode / QRCode 編碼專用 | 僅進行 Trim，**不進行任何格式化、裁切或視覺處理** |
| **Display Value（顯示值）** | 畫面顯示、標籤文字呈現 | 可依規範套用千分位、裁切（Ellipsis）等視覺處理 |

**資料流程圖：**

```
┌─────────────┐
│  資料來源   │
│ (Excel/JSON)│
└──────┬──────┘
       │
       ▼
┌─────────────┐
│   Trim      │
└──────┬──────┘
       │
       ├────────────────────────────────┐
       ▼                                ▼
┌─────────────┐                  ┌─────────────┐
│  Raw Value  │                  │Display Value│
│  (原始值)   │                  │  (顯示值)   │
└──────┬──────┘                  └──────┬──────┘
       │                                │
       ▼                                ▼
┌─────────────┐                  ┌─────────────┐
│  Barcode    │                  │  畫面顯示   │
│  QR Code    │                  │  標籤文字   │
└─────────────┘                  └─────────────┘
```

**強制規範：**

| 規範 | 說明 |
|------|------|
| 禁止行為 | **嚴禁將 Display Value 作為 Barcode 或 QRCode 的編碼來源** |
| 違規判定 | 若實作未明確區分 Raw Value 與 Display Value，視為規格不符 |

### 13.14 數量欄位（Quantity）之輸入與顯示限制

> 🔒 **數量欄位輸入端僅允許純數字**

**輸入限制（所有資料來源）：**

| 來源 | 允許輸入 | 禁止輸入 |
|------|----------|----------|
| Excel 匯入 | 純數字（0-9） | 千分位 `,`、空白、其他符號 |
| DataGrid 編輯 | 純數字（0-9） | 千分位 `,`、空白、其他符號 |
| 欄位編輯區 | 純數字（0-9） | 千分位 `,`、空白、其他符號 |

**顯示與編碼規則：**

| 層級 | 處理方式 | 範例 |
|------|----------|------|
| 顯示層（Display Layer） | 可加千分位 | 6733 → 6,733 |
| 儲存層（Storage Layer） | 原始數值 | 6733 |
| 編碼層（Encoding Layer） | 原始數值 | 6733 |

**錯誤處理：**

| 情況 | 處理 |
|------|------|
| 匯入含千分位數值 | 視為資料格式錯誤，依 8.9 錯誤處理規範處理 |
| 輸入含非數字字元 | 阻擋輸入或顯示驗證錯誤 |

### 13.15 缺值欄位之顯示與編碼語意差異說明

> 🔒 **此差異屬設計行為而非錯誤**

**缺值處理規則：**

| 欄位類型 | 畫面/標籤顯示 | 編碼內容 |
|----------|---------------|----------|
| Text | 顯示空白 | N/A |
| Barcode | 不產生條碼 | N/A |
| **QRCode（組合欄位）** | N/A | **保留欄位位置**（如 `A;;C`） |

**設計目的：**

| 目的 | 說明 |
|------|------|
| 結構一致性 | 維持 QR Code 資料結構一致性 |
| 解析穩定性 | 確保下游系統解析穩定 |

**禁止行為：**

| 禁止 | 說明 |
|------|------|
| 省略空值欄位位置 | **不得因畫面顯示為空白，即省略 QR Code 中之欄位位置** |

**範例：**

```
資料：pono="A", ima902="", ogd09="C"

正確 QR Code 內容：A;;C
錯誤 QR Code 內容：A;C  ← 禁止！
```

### 13.16 條碼與 QR Code 尺寸與縮放限制

> 🔒 **不得因版面配置因素進行過度縮放或壓縮條碼**

**尺寸規範：**

| 條碼類型 | 規格尺寸 | 縮放限制 |
|----------|----------|----------|
| Code 128 | 高度 10mm | 不得縮小至影響掃描 |
| QR Code | 20mm x 20mm | 不得改變模組比例 |

**禁止行為：**

| 禁止 | 說明 |
|------|------|
| 過度縮放 | 不得縮小至影響掃描成功率 |
| 比例變形 | 不得為塞版面而改變模組比例 |
| 裁切 Quiet Zone | 不得裁切條碼周圍的空白區域 |

**違規判定：**

| 情況 | 判定 |
|------|------|
| 因縮放導致掃描不穩定 | **視為規格不符** |

### 13.17 PDF 解析度與實體尺寸責任定義

> 🔒 **以實際列印與掃描結果作為判定標準**

**輸出要求：**

| 項目 | 規範 |
|------|------|
| 列印條件 | **300 DPI** |
| 尺寸要求 | 條碼、文字與版面實體尺寸須符合本規格定義之 mm 尺寸 |

**驗收標準：**

| 項目 | 說明 |
|------|------|
| 驗收依據 | **實際列印與掃描結果**（非 PDF 內部 DPI 設定值） |
| PDF 格式 | 向量格式，不以「設定 DPI 值」作為驗收依據 |

**條碼圖片生成規範（SD-03 釐清）：**

> ℹ️ **PDF 為向量格式，本身不具有 DPI 設定。「300 DPI」定義為條碼光柵化圖片生成時的像素密度基準。**

| 項目 | 規範 | 換算公式 |
|------|------|----------|
| 條碼生成 DPI | **300 DPI** | `像素 = 實體尺寸(mm) × 300 ÷ 25.4` |
| Code 128 高度 | 10mm | 10 × 300 ÷ 25.4 ≈ **118 像素** |
| QR Code 尺寸 | 20mm × 20mm | 20 × 300 ÷ 25.4 ≈ **236 × 236 像素** |

**技術說明：**

| 項目 | 說明 |
|------|------|
| ZXing.Net 參數 | `Width`、`Height` 以像素為單位，依上述公式換算 |
| QuestPDF 嵌入 | 條碼圖片以實體尺寸 (mm) 嵌入 PDF，由 PDF 閱讀器/印表機解析 |
| 列印驗收 | 以 300 DPI 列印時，條碼實體尺寸須符合本規格定義之 mm 值 |

**違規判定：**

| 情況 | 判定 |
|------|------|
| 列印後尺寸不符 | **視為輸出不合格** |
| 列印後掃描失敗 | **視為輸出不合格** |

### 13.18 規範違反判定（最後通牒）

> 🚨 **下列任一情況成立，即視為實作不符合規格**

**違規條件清單：**

| 編號 | 違規情況 | 嚴重程度 |
|------|----------|----------|
| V-01 | Barcode / QRCode 掃描失敗 | 🔴 嚴重 |
| V-02 | Display Value 被誤用於編碼 | 🔴 嚴重 |
| V-03 | 條碼或 QRCode 因縮放導致掃描不穩定 | 🔴 嚴重 |
| V-04 | 資料格式與本章節規定不一致 | 🟡 中等 |
| V-05 | Raw Value 與 Display Value 未分離 | 🟡 中等 |
| V-06 | QR Code 空值欄位位置被省略 | 🟡 中等 |

**不得作為例外理由：**

| 禁止理由 | 說明 |
|----------|------|
| 「實作方便」 | ❌ 不接受 |
| 「Library 限制」 | ❌ 不接受 |
| 「視覺正常」 | ❌ 不接受 |
| 「測試環境可以」 | ❌ 不接受 |

**最終聲明：**

```
┌─────────────────────────────────────────────────────────────────┐
│                                                                 │
│   本規格書之所有規範，以「PDF 輸出可被穩定掃描且內容正確」      │
│   作為唯一且最終之驗收標準。                                    │
│                                                                 │
│   任何技術選型、實作方式或視覺呈現，皆不得以任何理由            │
│   犧牲此一核心目標。                                            │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 13.C 可選強化規範（未來擴充與現場穩定性保護）

> ℹ️ **本節為非 POC 核心必要規範，目的在於提升系統於實務使用、資料極端情境與後續擴充時之穩定性。是否啟用可依專案階段決定，但一旦啟用即屬強制遵循。**

### 13.19 條碼與 QR Code 編碼內容長度限制（可選）

> ℹ️ **本條款用於避免因備註或自由輸入欄位過長，導致 QR Code 模組過密而影響掃描成功率**

**長度限制原則：**

| 項目 | 規範 |
|------|------|
| 目的 | 維持於實務可穩定掃描之長度範圍內 |
| 強制性 | **可選**（POC 階段不強制） |
| 判定依據 | 以「掃描穩定性」為準，不硬性定義最大字元數 |

**超長處理方式（若啟用）：**

| 情況 | 處理方式 |
|------|----------|
| 組合後編碼內容過長 | 系統提示警告訊息 |
| 嚴重超長 | 拒絕輸出該筆標籤 |

**建議長度參考：**

| 條碼類型 | 建議上限 | 說明 |
|----------|----------|------|
| Code 128 | 48 字元 | 超過會影響寬度與掃描 |
| QR Code | 500 字元 | 超過會導致模組過密 |

### 13.20 資料型別處理原則（POC 階段定調）

> 🔒 **POC 階段所有資料欄位一律以字串（String）作為內部儲存與處理型別**

**型別處理規則：**

| 項目 | 規範 |
|------|------|
| 內部儲存型別 | **一律字串（String）** |
| 型別推論 | **禁止**（不進行自動轉型） |
| 自動轉型 | **禁止**（不推論 number、date、decimal） |

**顯示格式定位：**

| 處理層 | 說明 |
|--------|------|
| 顯示層 | 日期格式、千分位等屬於顯示層行為 |
| Raw Value | **不受顯示格式影響** |
| 編碼內容 | **不受顯示格式影響** |

**設計目的：**

| 目的 | 說明 |
|------|------|
| 降低複雜度 | 簡化 POC 階段實作 |
| 避免資料不一致 | 防止型別推論錯誤導致資料異常 |
| 明確責任 | 資料源提供什麼就存什麼 |

**未來擴充：**

| 情況 | 處理 |
|------|------|
| 導入型別化處理 | 須另行修訂規格 |

### 13.21 錯誤與提示訊息語言一致性

> 🔒 **系統所有錯誤、警告與提示訊息以繁體中文為主要顯示語言**

**語言規範：**

| 項目 | 規範 |
|------|------|
| 主要語言 | **繁體中文** |
| 允許英文 | 僅限欄位代碼、錯誤代碼、系統識別用途 |
| 禁止行為 | 中英文混雜且語意重複之訊息描述 |

**訊息範例：**

| 類型 | 正確範例 | 錯誤範例 |
|------|----------|----------|
| 錯誤訊息 | 「缺少必要欄位：ogb19」 | 「Missing required field: ogb19 缺少必要欄位」 |
| 警告訊息 | 「數量欄位格式錯誤」 | 「Quantity format error 數量格式錯誤」 |
| 成功訊息 | 「PDF 已輸出至 output 資料夾」 | 「PDF exported successfully 輸出成功」 |

**設計目的：**

| 目的 | 說明 |
|------|------|
| 操作人員理解一致 | 現場人員能快速理解訊息 |
| 降低溝通成本 | 減少教育訓練負擔 |

### 13.22 本章節定位說明

> ℹ️ **即使 13.C 節未啟用，第 13 章其他條款仍為最高優先遵循規範**

**定位說明：**

| 項目 | 說明 |
|------|------|
| 13.C 節性質 | 防極端情境與未來擴充用規範 |
| 13.A / 13.B 節 | 仍為最高優先遵循規範 |
| 正式量產建議 | 將 13.C 節內容納入正式規格 |

**啟用狀態（POC 階段）：**

| 章節 | 啟用狀態 | 說明 |
|------|----------|------|
| 13.19 條碼長度限制 | ⚪ 可選 | 依實際掃描狀況決定 |
| **13.20 資料型別處理** | 🟢 **啟用** | POC 必要，避免型別混亂 |
| **13.21 訊息語言一致性** | 🟢 **啟用** | 台灣專案必備 |
| 13.22 定位說明 | ⚪ 說明性質 | 無需啟用 |

---

## 13.Ω 最終驗收封印條款（責任與爭議終結版）

> 🚨 **本節用於消除所有可能產生爭議、主觀解讀或灰色地帶之實作與驗收問題。本節條款一經納入，即視為最終裁定依據。**

### 13.23 預覽與 PDF 輸出之容許誤差定義

> 🔒 **明確定義「版面一致」的數值標準**

**誤差容許範圍：**

| 項目 | 容許誤差 | 說明 |
|------|----------|------|
| 欄位位置（X/Y） | **±0.5mm** | 實體尺寸換算後 |
| 欄位尺寸（W/H） | **±0.5mm** | 實體尺寸換算後 |

**超出誤差之判定：**

| 情況 | 判定 |
|------|------|
| 超過 ±0.5mm | 定位邏輯不一致，或渲染轉換流程不正確 |
| 超出容許誤差 | **規格不符合** |

**不得作為理由：**

| 禁止理由 | 說明 |
|----------|------|
| 「顯示裝置差異」 | ❌ 不接受 |
| 「縮放比例不同」 | ❌ 不接受 |
| 「抗鋸齒差異」 | ❌ 不接受 |

### 13.24 條碼與 QR Code 掃描穩定性最終定義

> 🔒 **明確定義「可掃描」的穩定性標準**

**掃描不穩定之定義（符合任一即視為不穩定）：**

| 編號 | 情況 | 判定 |
|------|------|------|
| S-01 | 需多次嘗試方可成功掃描 | ❌ 不穩定 |
| S-02 | 需特定角度、距離或操作技巧 | ❌ 不穩定 |
| S-03 | 不同掃描設備成功率明顯不一致 | ❌ 不穩定 |

**最終判定：**

| 規則 | 說明 |
|------|------|
| 掃描不穩定 | **等同掃描失敗** |
| 掃描失敗 | **驗收一律不通過** |

**穩定掃描之定義：**

| 項目 | 標準 |
|------|------|
| 成功率 | 首次嘗試即成功 |
| 角度 | 無需特定角度 |
| 距離 | 一般手持距離（10-30cm） |
| 設備 | 主流手機相機或掃描槍皆可 |

### 13.25 資料權威來源（Single Source of Truth）聲明

> 🔒 **data.json 為本系統唯一資料真相來源**

**權威來源定義：**

| 項目 | 權威來源 |
|------|----------|
| 資料管理頁顯示 | `data.json` |
| 標籤預覽 | `data.json` |
| PDF 輸出 | `data.json` |

**資料流架構：**

```
┌─────────────┐
│  data.json  │ ← 唯一真相來源（Single Source of Truth）
└──────┬──────┘
       │
       ├────────────────┬────────────────┐
       ▼                ▼                ▼
┌─────────────┐  ┌─────────────┐  ┌─────────────┐
│ 資料管理頁  │  │  標籤預覽   │  │  PDF 輸出   │
└─────────────┘  └─────────────┘  └─────────────┘
```

**禁止行為：**

| 禁止 | 說明 |
|------|------|
| 記憶體獨立狀態 | 不得於記憶體維護獨立資料狀態 |
| UI 元件獨立狀態 | 不得於 UI 元件維護獨立資料狀態 |
| 繞過 data.json | 不得作為繞過 `data.json` 之替代來源 |

**違規判定：**

| 情況 | 判定 |
|------|------|
| 輸出結果與 `data.json` 不一致 | **視為實作錯誤** |

### 13.26 最終優先順序與裁定權聲明

> 🚨 **第 13 章為本規格最高優先層級**

**優先順序：**

| 順序 | 層級 | 說明 |
|------|------|------|
| 1 | **13.Ω 節** | 最終驗收封印條款 |
| 2 | 13.A / 13.B / 13.C 節 | 實作約束與一致性規範 |
| 3 | 其他章節（1-12 章） | 功能需求與設計規格 |
| 4 | 附錄 | 參考資料 |

**衝突裁定原則：**

| 情況 | 裁定方式 |
|------|----------|
| 第 13 章與其他章節衝突 | **以第 13 章為準** |
| 第 13 章內部條款歧義 | 以「可掃描性、資料一致性與輸出穩定性」為最終裁定原則 |

### 13.27 本章節定位（最後一句）

> 🔒 **本章節一經納入，即代表實作者需完全理解並接受其約束**

**定位聲明：**

| 項目 | 說明 |
|------|------|
| 目的 | **終結實作與驗收爭議**（非增加功能） |
| 效力 | 一經納入即為最終裁定依據 |
| 約束 | 實作者需完全理解並接受 |
| 例外 | **不得事後主張誤解或例外情境** |

**最終宣告：**

```
┌─────────────────────────────────────────────────────────────────────────┐
│                                                                         │
│                    南茂標籤列印 POC 需求規格書                          │
│                                                                         │
│                         【最終驗收封印】                                │
│                                                                         │
│  ═══════════════════════════════════════════════════════════════════   │
│                                                                         │
│   ✓ PDF 輸出可被穩定掃描（首次即成功）                                 │
│   ✓ 掃描內容與 data.json 完全一致                                      │
│   ✓ 預覽與 PDF 版面誤差 ≤ ±0.5mm                                       │
│                                                                         │
│  ═══════════════════════════════════════════════════════════════════   │
│                                                                         │
│   以上三項同時成立，方為驗收通過。                                      │
│                                                                         │
│   任何技術選型、實作方式、視覺呈現或例外主張，                          │
│   皆不得犧牲此核心目標。                                                │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 附錄 A：資料源欄位清單

| 欄位名稱 | 範例資料 | 說明 |
|----------|----------|------|
| ogb03 | 1 | - |
| ogb19 | G25A111577 | 單據編號 |
| ogb092 | 00U35NVVR | - |
| ogb905 | 00U35NVVR | - |
| ogd12b | 001 | - |
| ogd12e | 001 | - |
| ima902 | FC7800280H-00000-00005 | 裝置編號 |
| ogd15 | 10.64 | - |
| ogd09 | 6733 | 數量 |
| obe25 | 2025-11-14 | 日期 |
| nvr_cust | XinshengIntelligent | 客戶名稱 |
| nvr_cust_item_no | XPA72EA0I-008 | 客戶料號 |
| nvr_cust_pn | E110-X0 | 客戶 P/N |
| nvr_remark10 | 00U35NVVR | 備註 |
| pono | 511-251020041 | 製令單號 |
| erpmat | 4D010018 | ERP 料號 |
| cscustpo | P600-X1725A3002627 | 客戶採購單號 |

---

## 附錄 B：資料模型定義

### B.1 data.json 結構

```json
{
  "version": "1.0",
  "lastModified": "2025-01-26T14:30:52",
  "records": [
    {
      "id": "uuid-xxxx-xxxx-xxxx",
      "ogb03": "1",
      "ogb19": "G25A111577",
      "ogb092": "00U35NVVR",
      "ogb905": "00U35NVVR",
      "ogd12b": "001",
      "ogd12e": "001",
      "ima902": "FC7800280H-00000-00005",
      "ogd15": "10.64",
      "ogd09": "6733",
      "obe25": "2025-11-14",
      "nvr_cust": "XinshengIntelligent",
      "nvr_cust_item_no": "XPA72EA0I-008",
      "nvr_cust_pn": "E110-X0",
      "nvr_remark10": "00U35NVVR",
      "pono": "511-251020041",
      "erpmat": "4D010018",
      "cscustpo": "P600-X1725A3002627"
    }
  ]
}
```

### B.2 欄位定義

| JSON 欄位 | 資料類型 | 必填 | 說明 |
|-----------|----------|------|------|
| version | string | 是 | 資料格式版本 |
| lastModified | string (ISO 8601) | 是 | 最後修改時間 |
| records | array | 是 | 資料紀錄陣列 |
| records[].id | string (UUID) | 是 | 紀錄唯一識別碼 |
| records[].ogb19 | string | 否 | 單據編號 |
| records[].nvr_cust | string | 否 | 客戶名稱 |
| records[].nvr_cust_item_no | string | 否 | 客戶料號 |
| records[].nvr_cust_pn | string | 否 | 客戶 P/N |
| records[].obe25 | string | 否 | 日期 |
| records[].ogd09 | string | 否 | 數量 |
| records[].pono | string | 否 | 製令單號 |
| records[].ima902 | string | 否 | 裝置編號 |
| records[].nvr_remark10 | string | 否 | 備註 |
| records[].erpmat | string | 否 | ERP 料號 |
| records[].cscustpo | string | 否 | 客戶採購單號 |

### B.3 DataRecord 類別定義

```
類別名稱：DataRecord
命名空間：NanmaoLabelPOC.Models

屬性：
- Id: string (UUID)
- Ogb03: string
- Ogb19: string（單據編號，用於 ListView 顯示）
- Ogb092: string
- Ogb905: string
- Ogd12b: string
- Ogd12e: string
- Ima902: string（裝置編號）
- Ogd15: string
- Ogd09: string（數量）
- Obe25: string（日期）
- NvrCust: string（客戶名稱）
- NvrCustItemNo: string（客戶料號）
- NvrCustPn: string（客戶 P/N）
- NvrRemark10: string（備註）
- Pono: string（製令單號）
- Erpmat: string（ERP 料號）
- Cscustpo: string（客戶採購單號）

方法：
- Clone(): DataRecord（深拷貝）
- Validate(): ValidationResult（資料驗證）
```

### B.4 LabelTemplate 類別定義

```
類別名稱：LabelTemplate
命名空間：NanmaoLabelPOC.Models

屬性：
- Code: string（標籤代碼，如 "QW075551-1"）
- Name: string（標籤名稱，如 "出貨標籤"）
- Width: double（標籤寬度 mm）
- Height: double（標籤高度 mm）
- Fields: List<LabelField>（欄位定義清單）
```

### B.5 LabelField 類別定義

```
類別名稱：LabelField
命名空間：NanmaoLabelPOC.Models

屬性：
- Name: string（欄位名稱，如 "CSCUSTOMER"）
- SourceField: string（資料來源欄位，如 "nvr_cust"）
- FieldType: FieldType（欄位類型：Text / Barcode / QRCode）
- X: double（X 座標 mm）
- Y: double（Y 座標 mm）
- Width: double（寬度 mm）
- Height: double（高度 mm）
- FontSize: double（字型大小 pt）
- FontWeight: FontWeight（字型粗細：Regular / Bold）
- Alignment: TextAlignment（對齊方式：Left / Center / Right）
- IsConstant: bool（是否為常數值）
- ConstantValue: string（常數值內容）
- CompositePattern: string（組合欄位模式，如 "{pono};{ima902}"）
```

---

## 變更紀錄

| 版本 | 日期 | 變更內容 | 作者 |
|------|------|----------|------|
| v1.0 | 2025-01-26 | 初版建立 | Swang |
| v1.1 | 2025-01-26 | 整合 Gemini 版本：新增系統架構、設定檔格式、邏輯處理規則、Type 欄位、測試情境、POC 產出物、開源套件建議 | Swang |
| v1.2 | 2025-01-26 | 技術規格定案：WPF + .NET 8 LTS、MVVM 架構、NuGet 套件選用（CommunityToolkit.Mvvm、ExcelDataReader、ZXing.Net、QuestPDF）、專案結構 | Swang |
| v1.3 | 2025-01-26 | 資料架構與 UI 流程定案：JSON 微型資料庫（config.json + data.json）、畫面佈局調整（預覽區在上、ListView 在下）、操作流程定義（單擊預覽、雙擊輸出）、更新測試情境與驗收標準 | Swang |
| v1.4 | 2025-01-26 | POC 簡化：標籤格式（QW075551-1、QW075551-2）改為程式碼內建，移除設定檔匯入功能，僅保留資料源匯入；更新系統架構、功能需求、畫面規劃、測試情境、驗收標準、專案結構 | Swang |
| v1.5 | 2025-01-26 | 新增資料管理功能：分頁設計（標籤列印 / 資料管理）、資料新增/編輯/刪除/儲存功能（F-10~F-13）、DataGrid 與欄位編輯區雙向同步、現場展示流程、更新測試情境（TC-13~TC-18）與驗收標準（A-13~A-18） | Swang |
| v1.6 | 2025-01-26 | 補充技術細節：標籤版面座標定義（5.1、5.2）、字型規格總覽（5.3）、錯誤處理規範（8.6）、UI 細節規範（8.7）、資料模型定義（附錄 B：JSON 結構、DataRecord、LabelTemplate、LabelField 類別） | Swang |
| v1.7 | 2025-01-26 | Kiosk 風格設計：16:9 橫式自適應佈局、左右分欄配置（預覽區 45% / 資料清單 55%）、Grid 比例配置、響應式元件規格、字體縮放基準、觸控友善設計、分頁指示器、狀態列 Emoji 圖示 | Swang |
| v1.8 | 2025-01-26 | 自訂標題列：WindowStyle="None" 無系統邊框、自訂標題列樣式（深藍 #1E3A5F）、全螢幕模式切換（F11/ESC）、標題列按鈕規格、視窗拖曳/雙擊最大化行為 | Swang |
| v1.9 | 2025-01-26 | 規格審查與補充：(1) QR Code 組合欄位統一使用資料源欄位名 (2) 檔案路徑規範（data.json、PDF 輸出目錄）(3) 分頁資料同步機制（儲存後同步）(4) 資料處理規範（Excel 匯入、日期/數量格式、長文字溢出、欄位缺失處理）(5) 條碼規格補充（下方文字、字元限制、QR Code 支援中文）(6) 標籤預覽區規格（縮放行為）(7) ListView 規格（分頁大小、選取樣式）(8) 空白狀態 UI | Swang |
| v2.0 | 2025-01-26 | **實作約束與一致性規範（第 13 章）**：(1) 座標換算公式（mm→pt、mm→px）(2) 預覽與 PDF 共用渲染邏輯 (3) 字型部署策略（PDF 嵌入字型）(4) 文字溢出改為「先裁切，不縮字」(5) Quiet Zone 不可裁切 (6) 欄位值 Trim 空白 (7) 雙擊事件處理規範 (8) 驗收三要素（可掃描、內容正確、版面一致） | Swang |
| v2.1 | 2025-01-26 | **補充一致性約束（13.8-13.12）**：(1) 數量欄位顯示值與編碼值分離（條碼禁止千分位）(2) 條碼/QR Code 禁止 Ellipsis 裁切 (3) PDF 輸出為唯一驗收權威來源 (4) Excel 欄位名稱僅允許英數，底線/空白/特殊符號不容錯 (5) 規範優先順序聲明（第 13 章優先，未定義行為由實作者判斷） | Swang |
| v2.2 | 2025-01-26 | **進階實作防歧義規範（13.B 工程師翻車封印）**：(1) Raw Value vs Display Value 分離原則與資料流程圖 (2) 數量欄位輸入端限制（僅允許純數字，禁止千分位輸入）(3) 缺值欄位語意差異（設計行為非錯誤，QR Code 保留空值位置）(4) 條碼尺寸與縮放限制（禁止過度縮放）(5) PDF 300 DPI 實體尺寸責任定義 (6) 規範違反判定清單與最後通牒 | Swang |
| v2.3 | 2025-01-26 | **可選強化規範（13.C 未來擴充與現場穩定性保護）**：(1) 條碼/QR Code 編碼內容長度限制（可選）(2) 資料型別處理原則（POC 階段一律字串，禁止型別推論）(3) 錯誤與提示訊息語言一致性（繁體中文為主）(4) 章節定位說明與啟用狀態表 | Swang |
| v2.4 | 2025-01-26 | **🔒 最終驗收封印條款（13.Ω 責任與爭議終結版）**：(1) 預覽與 PDF 容許誤差定義（±0.5mm）(2) 掃描穩定性最終定義（多次嘗試=失敗）(3) data.json 為 Single Source of Truth (4) 最終優先順序與裁定權聲明 (5) 最終宣告：三項驗收標準同時成立方為通過 | Swang |
| V2.5 | 2026-01-28 | 13.17 節新增「條碼圖片生成規範」表格，明確定義 300 DPI 像素換算公式與範例（SD-03 釐清） | Swang |
