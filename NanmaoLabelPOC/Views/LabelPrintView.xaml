<UserControl x:Class="NanmaoLabelPOC.Views.LabelPrintView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="clr-namespace:NanmaoLabelPOC.ViewModels"
             mc:Ignorable="d"
             d:DesignHeight="600" d:DesignWidth="1200"
             Background="#F5F5F5">

    <!--
    æ¨™ç±¤åˆ—å°åˆ†é 
    [ref: raw_spec 8.4]

    ä½ˆå±€ï¼š
    - å·¦å´ 45%ï¼šé è¦½å€ + æ ¼å¼é¸æ“‡
    - å³å´ 55%ï¼šè³‡æ–™æ¸…å–® + æ“ä½œæŒ‰éˆ•
    -->

    <Grid Margin="16">
        <Grid.ColumnDefinitions>
            <!-- å·¦å´ï¼šé è¦½å€ 45* [ref: raw_spec 8.4] -->
            <ColumnDefinition Width="45*"/>
            <!-- å³å´ï¼šè³‡æ–™æ¸…å–® 55* [ref: raw_spec 8.4] -->
            <ColumnDefinition Width="55*"/>
        </Grid.ColumnDefinitions>

        <!-- å·¦å´å€åŸŸ -->
        <Grid Grid.Column="0" Margin="0,0,8,0">
            <Grid.RowDefinitions>
                <!-- é è¦½å€ 1* -->
                <RowDefinition Height="*"/>
                <!-- æ ¼å¼é¸æ“‡ 70px [ref: raw_spec 8.4] -->
                <RowDefinition Height="70"/>
            </Grid.RowDefinitions>

            <!-- æ¨™ç±¤é è¦½å€ [ref: raw_spec 8.4] -->
            <Border Grid.Row="0"
                    Background="#F5F5F5"
                    BorderBrush="#E0E0E0"
                    BorderThickness="1"
                    CornerRadius="4">
                <Grid>
                    <!-- é è¦½å…§å®¹ï¼ˆCanvas ç”¨æ–¼æ¸²æŸ“æŒ‡ä»¤ï¼‰-->
                    <Viewbox Stretch="Uniform"
                             Margin="16"
                             Visibility="{Binding HasSelectedRecord, Converter={StaticResource BoolToVisibilityConverter}}">
                        <!-- æ¨™ç±¤èƒŒæ™¯ï¼š100mm x 60mm æ¯”ä¾‹ [ref: raw_spec 8.4] -->
                        <Border Width="400" Height="240"
                                Background="White"
                                BorderBrush="#CCCCCC"
                                BorderThickness="1">
                            <Border.Effect>
                                <DropShadowEffect ShadowDepth="2" Opacity="0.3" BlurRadius="8"/>
                            </Border.Effect>
                            <!-- é è¦½ Canvasï¼šæ¸²æŸ“æ¨™ç±¤å…§å®¹ -->
                            <Canvas x:Name="PreviewCanvas"
                                    Width="400" Height="240"
                                    ClipToBounds="True"/>
                        </Border>
                    </Viewbox>

                    <!-- ç©ºç™½ç‹€æ…‹æç¤º [ref: raw_spec 8.4] -->
                    <StackPanel HorizontalAlignment="Center"
                                VerticalAlignment="Center"
                                Visibility="{Binding HasSelectedRecord, Converter={StaticResource InverseBoolToVisibilityConverter}}">
                        <TextBlock Text="ðŸ“‹"
                                   FontSize="48"
                                   HorizontalAlignment="Center"
                                   Margin="0,0,0,16"/>
                        <TextBlock Text="è«‹å…ˆåŒ¯å…¥è³‡æ–™"
                                   FontSize="16"
                                   Foreground="#888888"
                                   HorizontalAlignment="Center"/>
                        <TextBlock Text="æˆ–é¸å–è³‡æ–™é …ç›®"
                                   FontSize="16"
                                   Foreground="#888888"
                                   HorizontalAlignment="Center"/>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- æ ¼å¼é¸æ“‡å€ [ref: raw_spec 8.6] -->
            <!-- T061: ä¸‹æ‹‰é¸å–®é«˜åº¦ 36-40px -->
            <Grid Grid.Row="1" Margin="0,16,0,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <TextBlock Grid.Column="0"
                           Text="æ¨™ç±¤æ ¼å¼"
                           VerticalAlignment="Center"
                           FontSize="14"
                           FontWeight="Bold"
                           FontFamily="Microsoft JhengHei"
                           Margin="0,0,12,0"/>

                <!-- æ ¼å¼ä¸‹æ‹‰é¸å–® [ref: raw_spec 8.4, 8.6] -->
                <!-- T061: ä¸‹æ‹‰é¸å–® min 36px, recommended 40px -->
                <ComboBox Grid.Column="1"
                          ItemsSource="{Binding AvailableTemplates}"
                          SelectedItem="{Binding SelectedTemplate}"
                          DisplayMemberPath="DisplayName"
                          MinHeight="40"
                          Height="40"
                          FontSize="14"
                          FontFamily="Microsoft JhengHei"
                          Padding="8,0"/>
            </Grid>
        </Grid>

        <!-- å³å´å€åŸŸ -->
        <Grid Grid.Column="1" Margin="8,0,0,0">
            <Grid.RowDefinitions>
                <!-- è³‡æ–™æ¸…å–® 1* -->
                <RowDefinition Height="*"/>
                <!-- åˆ†é æŒ‡ç¤ºå™¨ Auto -->
                <RowDefinition Height="Auto"/>
                <!-- æ“ä½œæŒ‰éˆ• 70px [ref: raw_spec 8.4] -->
                <RowDefinition Height="70"/>
            </Grid.RowDefinitions>

            <!-- è³‡æ–™æ¸…å–® ListView [ref: raw_spec 8.4] -->
            <Border Grid.Row="0"
                    Background="White"
                    BorderBrush="#E0E0E0"
                    BorderThickness="1"
                    CornerRadius="4">
                <Grid>
                    <!-- æœ‰è³‡æ–™æ™‚é¡¯ç¤º ListView [ref: raw_spec 8.4] T070 -->
                    <ListView x:Name="RecordListView"
                              ItemsSource="{Binding PagedRecords}"
                              SelectedItem="{Binding SelectedRecord, Mode=TwoWay}"
                              SelectionMode="Single"
                              BorderThickness="0"
                              Background="Transparent"
                              Visibility="{Binding HasRecords, Converter={StaticResource BoolToVisibilityConverter}}"
                              MouseDoubleClick="RecordListView_MouseDoubleClick">
                        <ListView.ItemTemplate>
                            <DataTemplate>
                                <!-- é …ç›®é«˜åº¦ 50px [ref: raw_spec 8.4, 8.6] -->
                                <!-- T061: ListView é …ç›® min 40px, recommended 50px -->
                                <Grid Height="50" MinHeight="50" Margin="8,0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <!-- å–®æ“šç·¨è™Ÿ [ref: raw_spec 8.4, 8.6] -->
                                    <!-- T061: æ¸…å–®é …ç›®å­—é«” 14pt -->
                                    <StackPanel Grid.Column="0"
                                                Orientation="Horizontal"
                                                VerticalAlignment="Center">
                                        <TextBlock Text="ðŸ“¦ " FontSize="16"/>
                                        <TextBlock Text="{Binding Ogb19}"
                                                   FontSize="14"
                                                   FontWeight="Bold"
                                                   FontFamily="Microsoft JhengHei"/>
                                    </StackPanel>

                                    <!-- åˆ†éš”ç·š + å®¢æˆ¶åç¨± -->
                                    <StackPanel Grid.Column="1"
                                                Orientation="Horizontal"
                                                VerticalAlignment="Center"
                                                Margin="16,0">
                                        <TextBlock Text="â”‚ "
                                                   Foreground="#CCCCCC"
                                                   FontSize="14"/>
                                        <TextBlock Text="{Binding NvrCust}"
                                                   FontSize="14"
                                                   FontFamily="Microsoft JhengHei"
                                                   TextTrimming="CharacterEllipsis"
                                                   MaxWidth="200"/>
                                    </StackPanel>

                                    <!-- æ•¸é‡ -->
                                    <StackPanel Grid.Column="2"
                                                Orientation="Horizontal"
                                                VerticalAlignment="Center">
                                        <TextBlock Text="â”‚ "
                                                   Foreground="#CCCCCC"
                                                   FontSize="14"/>
                                        <TextBlock Text="{Binding Ogd09, StringFormat=N0}"
                                                   FontSize="14"
                                                   FontFamily="Microsoft JhengHei"/>
                                    </StackPanel>
                                </Grid>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                        <ListView.ItemContainerStyle>
                            <Style TargetType="ListViewItem">
                                <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                                <Setter Property="Padding" Value="8,0"/>
                                <Style.Triggers>
                                    <!-- é¸å–æ¨£å¼ [ref: raw_spec 8.4] -->
                                    <Trigger Property="IsSelected" Value="True">
                                        <Setter Property="Background" Value="#0078D4"/>
                                        <Setter Property="Foreground" Value="White"/>
                                    </Trigger>
                                    <!-- Hover æ¨£å¼ [ref: raw_spec 8.4] -->
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter Property="Background" Value="#F0F0F0"/>
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </ListView.ItemContainerStyle>
                    </ListView>

                    <!-- ç„¡è³‡æ–™æ™‚é¡¯ç¤ºç©ºç™½ç‹€æ…‹ [ref: raw_spec 8.4] -->
                    <StackPanel HorizontalAlignment="Center"
                                VerticalAlignment="Center"
                                Visibility="{Binding HasRecords, Converter={StaticResource InverseBoolToVisibilityConverter}}">
                        <TextBlock Text="ðŸ“‚"
                                   FontSize="48"
                                   HorizontalAlignment="Center"
                                   Margin="0,0,0,16"/>
                        <TextBlock Text="å°šç„¡è³‡æ–™"
                                   FontSize="18"
                                   Foreground="#888888"
                                   HorizontalAlignment="Center"
                                   FontFamily="Microsoft JhengHei"/>
                        <TextBlock Text="è«‹è‡³ã€Œè³‡æ–™ç®¡ç†ã€åˆ†é åŒ¯å…¥ Excel"
                                   FontSize="14"
                                   Foreground="#AAAAAA"
                                   HorizontalAlignment="Center"
                                   FontFamily="Microsoft JhengHei"
                                   Margin="0,8,0,0"/>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- ============================================================ -->
            <!-- åˆ†é å°Žèˆªå€ï¼ˆç½®ä¸­ï¼‰[FR-006]                                    -->
            <!-- T014: åˆ†é å°ŽèˆªæŒ‰éˆ•ï¼ˆâ—€ â–¶ï¼‰ç½®ä¸­é¡¯ç¤º                            -->
            <!-- T017: å¥—ç”¨ SecondaryButtonStyle                               -->
            <!-- ============================================================ -->
            <StackPanel Grid.Row="1"
                        Orientation="Horizontal"
                        HorizontalAlignment="Center"
                        Margin="0,8"
                        Visibility="{Binding HasRecords, Converter={StaticResource BoolToVisibilityConverter}}">
                <!-- ä¸Šä¸€é æŒ‰éˆ• â—€ -->
                <Button Command="{Binding PreviousPageCommand}"
                        Style="{StaticResource SecondaryButtonStyle}"
                        Width="50" Height="50"
                        FontSize="18"
                        FontFamily="Microsoft JhengHei"
                        Content="â—€"
                        ToolTip="ä¸Šä¸€é "/>

                <!-- é ç¢¼æŒ‡ç¤ºå™¨ -->
                <TextBlock Text="{Binding PageIndicatorText}"
                           VerticalAlignment="Center"
                           FontSize="14"
                           FontWeight="Bold"
                           FontFamily="Microsoft JhengHei"
                           Foreground="#333333"
                           Margin="16,0"/>

                <!-- ä¸‹ä¸€é æŒ‰éˆ• â–¶ -->
                <Button Command="{Binding NextPageCommand}"
                        Style="{StaticResource SecondaryButtonStyle}"
                        Width="50" Height="50"
                        FontSize="18"
                        FontFamily="Microsoft JhengHei"
                        Content="â–¶"
                        ToolTip="ä¸‹ä¸€é "/>
            </StackPanel>

            <!-- ============================================================ -->
            <!-- æ“ä½œæŒ‰éˆ•å€ï¼ˆä¸¦æŽ’ç½®ä¸­ï¼‰[FR-005]                                -->
            <!-- T013: è¼¸å‡º PDF å’Œæ‰¹æ¬¡è¼¸å‡ºå…¨éƒ¨æŒ‰éˆ•ä¸¦æŽ’ç½®ä¸­é¡¯ç¤º                 -->
            <!-- T016: å¥—ç”¨ ActionButtonStyle                                  -->
            <!-- ============================================================ -->
            <StackPanel Grid.Row="2"
                        Orientation="Horizontal"
                        HorizontalAlignment="Center"
                        Margin="0,8,0,0">
                <!-- è¼¸å‡º PDF æŒ‰éˆ• -->
                <Button Command="{Binding ExportPdfCommand}"
                        Style="{StaticResource ActionButtonStyle}"
                        MinWidth="140" MinHeight="50"
                        Height="50"
                        FontSize="14"
                        FontFamily="Microsoft JhengHei">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="ðŸ“„ " FontSize="18" VerticalAlignment="Center"/>
                        <TextBlock Text="è¼¸å‡º PDF" VerticalAlignment="Center"/>
                    </StackPanel>
                </Button>

                <!-- æ‰¹æ¬¡è¼¸å‡ºå…¨éƒ¨æŒ‰éˆ•ï¼ˆé–“è· 16pxï¼‰-->
                <Button x:Name="BatchExportButton"
                        Command="{Binding BatchExportCommand}"
                        Style="{StaticResource ActionButtonStyle}"
                        MinWidth="140" MinHeight="50"
                        Height="50"
                        Margin="16,0,0,0"
                        FontSize="14"
                        FontFamily="Microsoft JhengHei"
                        Click="BatchExportButton_Click">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="ðŸ“‘ " FontSize="18" VerticalAlignment="Center"/>
                        <TextBlock Text="æ‰¹æ¬¡è¼¸å‡ºå…¨éƒ¨" VerticalAlignment="Center"/>
                    </StackPanel>
                </Button>
            </StackPanel>
        </Grid>
    </Grid>
</UserControl>
